<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agenda</title>

<style>
  @font-face{
    font-family:"Rokiest";
    src:url("https://waycompanygg.github.io/roteiro/assets/fonts/Rokiest-Extrabold.otf") format("opentype");
    font-weight:800;
    font-display:swap;
  }

  :root{
    --bg1:#0b0f19; --bg2:#0f172a;
    --panel: rgba(11,18,32,.78);
    --stroke: rgba(255,255,255,.10);
    --text:#e5e7eb; --muted: rgba(229,231,235,.62);

    /* Paleta roxa ‚Äúbrilhoso‚Äù */
    --p1:#7c3aed;
    --p2:#a855f7;
    --p3:#22d3ee;

    --shadow: 0 26px 90px rgba(0,0,0,.72);
  }

  *{ box-sizing:border-box }
  body{
    margin:0;
    min-height:100vh;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color: var(--text);
    background:
      radial-gradient(1000px 600px at 12% 8%, rgba(124,58,237,.20), transparent 60%),
      radial-gradient(1000px 600px at 90% 12%, rgba(168,85,247,.14), transparent 60%),
      radial-gradient(900px 560px at 65% 96%, rgba(34,211,238,.10), transparent 60%),
      linear-gradient(135deg, var(--bg1), var(--bg2));
    padding: 22px;
    overflow-x:hidden;
  }

  /* Home */
  .home{
    position:fixed; top:16px; left:16px;
    background:rgba(17,24,39,.92);
    border:1px solid rgba(255,255,255,.12);
    color:#fff; text-decoration:none;
    font-weight:900; font-size:14px;
    padding:10px 12px;
    border-radius:12px;
    box-shadow:0 12px 30px rgba(0,0,0,.45);
    transition:.15s;
    z-index:10;
  }
  .home:hover{ transform:translateY(-1px); opacity:.92 }

  .wrap{
    width:min(1240px, 100%);
    margin: 0 auto;
    background: var(--panel);
    border: 1px solid var(--stroke);
    border-radius: 26px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    overflow:hidden;
    animation: in .45s ease both;
  }

  @keyframes in{
    from{opacity:0; transform: translateY(12px) scale(.99)}
    to{opacity:1; transform: translateY(0) scale(1)}
  }

  /* Header */
  .head{
    padding: 18px 18px 14px;
    border-bottom:1px solid rgba(255,255,255,.08);
    display:flex;
    align-items:flex-end;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
  }
  .title{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  h1{
    margin:0;
    font-family: Rokiest;
    letter-spacing:.9px;
    font-size: 34px;
    line-height:1;
  }
  .sub{
    margin:0;
    color: var(--muted);
    font-size:13px;
  }

  .controls{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  .chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 10px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
    color: rgba(229,231,235,.75);
    font-weight: 900;
    font-size: 12px;
  }

  .btn{
    height: 42px;
    padding: 0 14px;
    border-radius: 14px;
    border: 0;
    color:#fff;
    font-weight: 900;
    cursor:pointer;
    transition: .15s;
    display:inline-flex;
    align-items:center;
    gap:8px;
    box-shadow: 0 14px 30px rgba(0,0,0,.25);
  }
  .btn:hover{ transform: translateY(-1px); opacity:.96 }
  .btn:active{ transform: translateY(0); opacity:.9 }

  .btnPurple{
    background: linear-gradient(135deg, var(--p1), var(--p2));
  }
  .btnGhost{
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.10);
    box-shadow:none;
  }

  /* Layout principal: calend√°rio + painel lateral */
  .main{
    display:grid;
    grid-template-columns: 1.45fr .55fr;
    gap: 12px;
    padding: 14px;
  }
  @media(max-width: 980px){
    .main{ grid-template-columns: 1fr; }
  }

  .card{
    background: rgba(255,255,255,.04);
    border: 1px solid rgba(255,255,255,.10);
    border-radius: 20px;
    padding: 14px;
  }
  .cardTitle{
    margin:0;
    font-family:Rokiest;
    letter-spacing:.6px;
    font-size: 18px;
  }
  .cardSub{
    margin:6px 0 0;
    color: rgba(229,231,235,.62);
    font-size: 12px;
  }

  /* Calend√°rio ‚Äúretangular‚Äù */
  .calTop{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    margin-top:10px;
  }
  .month{
    font-weight: 900;
    font-size: 14px;
    color: rgba(229,231,235,.85);
  }
  .navRow{
    display:flex;
    gap:8px;
  }
  .navBtn{
    height: 38px;
    padding: 0 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(2,6,23,.45);
    color:#fff;
    font-weight: 900;
    cursor:pointer;
    transition:.15s;
  }
  .navBtn:hover{ transform: translateY(-1px); opacity:.95 }

  .week{
    margin-top: 12px;
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
  }
  .dow{
    text-align:center;
    font-size: 12px;
    color: rgba(229,231,235,.55);
    font-weight: 900;
    padding: 8px 0;
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 12px;
    background: rgba(2,6,23,.26);
  }

  .grid{
    margin-top: 8px;
    display:grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
  }

  /* ‚úÖ MAIS RETANGULAR + MAIS ESPA√áO PARA COMPROMISSOS */
  .cell{
    min-height: 130px;              /* AQUI fica bem mais alto */
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.40);
    padding: 10px;
    position:relative;
    overflow:hidden;
    cursor:pointer;
    transition:.16s;
  }
  .cell:hover{
    transform: translateY(-2px);
    border-color: rgba(168,85,247,.35);
    box-shadow: 0 16px 40px rgba(168,85,247,.14);
  }
  .cell:active{ transform: translateY(0); opacity:.95 }

  .cell .day{
    font-weight: 900;
    color: rgba(229,231,235,.88);
    font-size: 12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    margin-bottom: 8px;
  }
  .cell .hint{
    font-size: 11px;
    color: rgba(229,231,235,.46);
    font-weight: 900;
  }

  .out{
    opacity:.45;
    filter: saturate(.85);
  }

  /* Lista de compromissos dentro da c√©lula */
  .events{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .eventPill{
    width: 100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    padding: 8px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.04);
    transition:.12s;
    transform-origin:left center;
  }
  .eventPill:hover{ transform: scale(1.01); opacity:.98 }
  .eventLeft{
    display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0;
  }
  .eventName{
    font-size: 12px;
    font-weight: 900;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .eventMeta{
    font-size: 11px;
    color: rgba(229,231,235,.60);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .tag{
    font-size: 11px;
    font-weight: 900;
    padding: 6px 10px;
    border-radius: 999px;
    white-space:nowrap;
  }

  /* Status tags */
  .tShow{ background: rgba(6,182,212,.16); border: 1px solid rgba(6,182,212,.35); color: rgba(229,231,235,.92); }
  .tReservado{ background: rgba(245,158,11,.16); border: 1px solid rgba(245,158,11,.34); color: rgba(229,231,235,.92); }
  .tHold{ background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.12); color: rgba(229,231,235,.82); }
  .tCancel{ background: rgba(239,68,68,.16); border: 1px solid rgba(239,68,68,.35); color: rgba(229,231,235,.92); }

  /* Artistas (cores de contraste) */
  .aX{ border-color: rgba(250,204,21,.42); background: rgba(250,204,21,.12); }   /* amarelo */
  .aY{ border-color: rgba(249,115,22,.42); background: rgba(249,115,22,.12); }   /* laranja */
  .aZ{ border-color: rgba(168,85,247,.38); background: rgba(168,85,247,.12); }  /* roxo */

  /* Painel lateral */
  .legend{
    margin-top: 10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .legendRow{
    display:flex;
    gap:10px;
    align-items:center;
    padding: 10px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(2,6,23,.30);
  }
  .dot{
    width:12px;
    height:12px;
    border-radius: 999px;
  }
  .dotX{ background: rgb(250,204,21); }
  .dotY{ background: rgb(249,115,22); }
  .dotZ{ background: rgb(168,85,247); }
  .legendTxt{
    display:flex;
    flex-direction:column;
    gap:2px;
    min-width:0;
  }
  .legendName{
    font-weight: 900;
    font-size: 13px;
  }
  .legendHint{
    font-size: 11px;
    color: rgba(229,231,235,.60);
  }

  /* Overlay / Modal (criar/editar) */
  .overlay{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(12px);
    z-index: 9999;
    padding: 18px;
  }
  .modal{
    width: min(640px, 96vw);
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(11,18,32,.92);
    box-shadow: 0 24px 80px rgba(0,0,0,.70);
    overflow:hidden;
    animation: pop .20s ease both;
  }
  @keyframes pop{from{opacity:0;transform:scale(.985) translateY(8px)}to{opacity:1;transform:scale(1) translateY(0)}}

  .modalHead{
    padding: 14px 14px 10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    border-bottom:1px solid rgba(255,255,255,.08);
  }
  .modalTitle{
    font-family:Rokiest;
    letter-spacing:.6px;
    font-size: 20px;
  }
  .xBtn{
    height: 40px;
    width: 44px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color:#fff;
    font-weight: 900;
    cursor:pointer;
    transition:.12s;
  }
  .xBtn:hover{ transform: translateY(-1px); opacity:.96 }

  .modalBody{
    padding: 14px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:10px;
  }
  @media(max-width: 720px){
    .modalBody{ grid-template-columns: 1fr; }
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:6px;
  }
  .field label{
    font-size: 12px;
    color: rgba(229,231,235,.72);
    font-weight: 900;
  }
  .field input, .field select, .field textarea{
    height: 44px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(2,6,23,.55);
    color: var(--text);
    padding: 10px 12px;
    outline:none;
    transition:.15s;
  }
  .field textarea{
    height: 92px;
    resize:none;
  }
  .field input:focus, .field select:focus, .field textarea:focus{
    border-color: rgba(168,85,247,.55);
    box-shadow: 0 0 0 4px rgba(168,85,247,.18);
  }

  .modalFoot{
    padding: 12px 14px 14px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    border-top:1px solid rgba(255,255,255,.08);
  }

  /* Loader */
  .loading{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(0,0,0,.55);
    backdrop-filter: blur(12px);
    z-index: 10000;
  }
  .loaderBox{
    width: min(520px, 92vw);
    border-radius: 22px;
    border: 1px solid rgba(255,255,255,.14);
    background: rgba(11,18,32,.92);
    box-shadow: 0 24px 80px rgba(0,0,0,.70);
    padding: 18px;
    text-align:center;
    animation: pop .20s ease both;
  }
  .ring{
    width: 64px; height: 64px;
    border-radius: 999px;
    border: 3px solid rgba(255,255,255,.16);
    border-top-color: rgba(168,85,247,.98);
    margin: 8px auto 12px;
    animation: spin .9s linear infinite;
  }
  @keyframes spin{ to{ transform: rotate(360deg) } }

  /* Toast */
  .toast{
    position:fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(17,24,39,.95);
    border: 1px solid rgba(255,255,255,.12);
    border-radius: 14px;
    padding: 10px 12px;
    font-weight: 900;
    opacity:0;
    pointer-events:none;
    transition: .2s;
    z-index: 10001;
    box-shadow: 0 16px 40px rgba(0,0,0,.45);
  }
  .toast.show{ opacity:1 }
</style>
</head>

<body>
<a class="home" href="index.html">üè† Home</a>

<div class="wrap">
  <div class="head">
    <div class="title">
      <h1>Agenda</h1>
      <p class="sub">Calend√°rio visual com compromissos ‚Ä¢ artistas X / Y / Z ‚Ä¢ status: show / reservado / hold</p>
    </div>

    <div class="controls">
      <span class="chip">‚ú® Visual (sem banco)</span>
      <button class="btn btnGhost" id="btnToday">Hoje</button>
      <button class="btn btnPurple" id="btnNew">Ôºã Novo compromisso</button>
    </div>
  </div>

  <div class="main">
    <!-- Calend√°rio -->
    <div class="card">
      <div class="calTop">
        <div class="month" id="monthLabel">‚Äî</div>
        <div class="navRow">
          <button class="navBtn" id="prev">‚óÄ</button>
          <button class="navBtn" id="next">‚ñ∂</button>
        </div>
      </div>

      <div class="week">
        <div class="dow">DOM</div><div class="dow">SEG</div><div class="dow">TER</div>
        <div class="dow">QUA</div><div class="dow">QUI</div><div class="dow">SEX</div><div class="dow">SAB</div>
      </div>

      <div class="grid" id="grid"></div>
    </div>

    <!-- Lateral -->
    <div class="card">
      <h3 class="cardTitle">Artistas</h3>
      <p class="cardSub">Cada artista tem cor de contraste pra bater o olho.</p>

      <div class="legend">
        <div class="legendRow">
          <span class="dot dotX"></span>
          <div class="legendTxt">
            <div class="legendName">Artista X</div>
            <div class="legendHint">Destaque amarelo</div>
          </div>
        </div>

        <div class="legendRow">
          <span class="dot dotY"></span>
          <div class="legendTxt">
            <div class="legendName">Artista Y</div>
            <div class="legendHint">Destaque laranja</div>
          </div>
        </div>

        <div class="legendRow">
          <span class="dot dotZ"></span>
          <div class="legendTxt">
            <div class="legendName">Artista Z</div>
            <div class="legendHint">Destaque roxo</div>
          </div>
        </div>
      </div>

      <div style="height:12px"></div>

      <h3 class="cardTitle">Status</h3>
      <p class="cardSub">Voc√™ escolhe no formul√°rio.</p>
      <div class="legend" style="margin-top:10px">
        <div class="legendRow"><span class="tag tShow">SHOW</span><div class="legendHint">Compromisso confirmado</div></div>
        <div class="legendRow"><span class="tag tReservado">RESERVADO</span><div class="legendHint">Proposto / aguardando</div></div>
        <div class="legendRow"><span class="tag tHold">HOLD</span><div class="legendHint">Pr√©-reserva</div></div>
      </div>
    </div>
  </div>
</div>

<!-- Modal criar/editar -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modalHead">
      <div class="modalTitle" id="modalTitle">Novo compromisso</div>
      <button class="xBtn" id="closeModal">‚úñ</button>
    </div>

    <div class="modalBody">
      <div class="field">
        <label>Data</label>
        <input id="f_date" type="date">
      </div>

      <div class="field">
        <label>Hora do show</label>
        <input id="f_time" type="time" value="21:00">
      </div>

      <div class="field">
        <label>Artista</label>
        <select id="f_artist">
          <option value="X">Artista X</option>
          <option value="Y">Artista Y</option>
          <option value="Z">Artista Z</option>
        </select>
      </div>

      <div class="field">
        <label>Status</label>
        <select id="f_status">
          <option value="SHOW">SHOW</option>
          <option value="RESERVADO">RESERVADO</option>
          <option value="HOLD">HOLD</option>
          <option value="CANCELADO">CANCELADO</option>
        </select>
      </div>

      <div class="field" style="grid-column:1/-1">
        <label>Endere√ßo</label>
        <input id="f_address" placeholder="Rua, n√∫mero, bairro...">
      </div>

      <div class="field">
        <label>Contratante</label>
        <input id="f_contratante" placeholder="Nome do contratante">
      </div>

      <div class="field">
        <label>Telefone</label>
        <input id="f_phone" placeholder="(DD) 9xxxx-xxxx">
      </div>

      <div class="field">
        <label>Contrato enviado?</label>
        <select id="f_contract">
          <option value="NAO">N√£o</option>
          <option value="SIM">Sim</option>
        </select>
      </div>

      <div class="field">
        <label>Observa√ß√µes</label>
        <textarea id="f_notes" placeholder="Detalhes extras‚Ä¶ (visual por enquanto)"></textarea>
      </div>
    </div>

    <div class="modalFoot">
      <button class="btn btnGhost" id="btnCancel">Cancelar</button>
      <button class="btn btnPurple" id="btnSave">Salvar (visual)</button>
    </div>
  </div>
</div>

<!-- Loading -->
<div class="loading" id="loading">
  <div class="loaderBox">
    <div class="ring"></div>
    <div style="font-family:Rokiest; font-size:22px; letter-spacing:.6px;">Carregando‚Ä¶</div>
    <div style="margin-top:6px; color:rgba(229,231,235,.65); font-size:13px;">Aguarde</div>
  </div>
</div>

<div class="toast" id="toast">‚úÖ</div>

<script>
  // =========================
  // DADOS (VISUAL) - EXEMPLO
  // =========================
  // cada item:
  // { id, date:'YYYY-MM-DD', time:'HH:MM', artist:'X|Y|Z', status:'SHOW|RESERVADO|HOLD|CANCELADO', title, address, phone, contratante, contractSent:'SIM|NAO' }
  let events = [
    {
      id: "e1",
      date: toISO(new Date()),
      time: "21:00",
      artist: "X",
      status: "SHOW",
      title: "Show - Artista X",
      address: "Av. Exemplo, 123",
      phone: "(21) 90000-0000",
      contratante: "Contratante A",
      contractSent: "SIM"
    },
    {
      id: "e2",
      date: addDays(toISO(new Date()), 2),
      time: "20:30",
      artist: "Y",
      status: "RESERVADO",
      title: "Evento - Artista Y",
      address: "Rua Teste, 77",
      phone: "(11) 98888-1111",
      contratante: "Contratante B",
      contractSent: "NAO"
    },
    {
      id: "e3",
      date: addDays(toISO(new Date()), 6),
      time: "22:00",
      artist: "Z",
      status: "HOLD",
      title: "Poss√≠vel show - Artista Z",
      address: "Centro, s/n",
      phone: "(31) 97777-2222",
      contratante: "Contratante C",
      contractSent: "NAO"
    }
  ];

  // =========================
  // UI / CALEND√ÅRIO
  // =========================
  const grid = document.getElementById("grid");
  const monthLabel = document.getElementById("monthLabel");
  const overlay = document.getElementById("overlay");
  const loading = document.getElementById("loading");
  const toastEl = document.getElementById("toast");

  const btnNew = document.getElementById("btnNew");
  const btnToday = document.getElementById("btnToday");
  const btnSave = document.getElementById("btnSave");
  const btnCancel = document.getElementById("btnCancel");
  const closeModal = document.getElementById("closeModal");
  const modalTitle = document.getElementById("modalTitle");

  const prev = document.getElementById("prev");
  const next = document.getElementById("next");

  const f_date = document.getElementById("f_date");
  const f_time = document.getElementById("f_time");
  const f_artist = document.getElementById("f_artist");
  const f_status = document.getElementById("f_status");
  const f_address = document.getElementById("f_address");
  const f_contratante = document.getElementById("f_contratante");
  const f_phone = document.getElementById("f_phone");
  const f_contract = document.getElementById("f_contract");
  const f_notes = document.getElementById("f_notes");

  let viewDate = new Date(); // m√™s atual
  let editingId = null;

  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 1500);
  }

  function setLoading(on){
    loading.style.display = on ? "flex" : "none";
  }

  function openModal(title){
    modalTitle.textContent = title;
    overlay.style.display = "flex";
  }
  function close(){
    overlay.style.display = "none";
    editingId = null;
  }

  function monthName(d){
    const m = d.toLocaleString("pt-BR", { month:"long" });
    return m.charAt(0).toUpperCase() + m.slice(1);
  }

  function render(){
    const y = viewDate.getFullYear();
    const m = viewDate.getMonth();

    monthLabel.textContent = `${monthName(viewDate)} ${y}`;

    // primeiro dia do m√™s e grade 6 semanas
    const first = new Date(y, m, 1);
    const startDow = first.getDay(); // 0 dom
    const start = new Date(y, m, 1 - startDow);

    const cells = [];
    for(let i=0;i<42;i++){
      const d = new Date(start);
      d.setDate(start.getDate() + i);
      cells.push(d);
    }

    grid.innerHTML = cells.map(d=>{
      const iso = toISO(d);
      const inMonth = d.getMonth() === m;
      const dayEvents = eventsForDate(iso);

      return `
        <div class="cell ${inMonth ? "" : "out"}" data-date="${iso}">
          <div class="day">
            <span>${d.getDate()}</span>
            <span class="hint">${dayEvents.length ? dayEvents.length + "x" : ""}</span>
          </div>
          <div class="events">
            ${dayEvents.slice(0,3).map(ev => pill(ev)).join("")}
            ${dayEvents.length>3 ? `<div class="eventMeta" style="padding:2px 2px; opacity:.7">+${dayEvents.length-3} mais</div>` : ""}
          </div>
        </div>
      `;
    }).join("");

    // clique nas c√©lulas
    [...document.querySelectorAll(".cell")].forEach(el=>{
      el.addEventListener("click", (e)=>{
        const date = el.getAttribute("data-date");
        // Se clicou em um pill (compromisso), abre edi√ß√£o
        const pillEl = e.target.closest(".eventPill");
        if(pillEl){
          const id = pillEl.getAttribute("data-id");
          openEdit(id);
          return;
        }
        // clique vazio: criar compromisso nessa data
        openCreate(date);
      });
    });
  }

  function pill(ev){
    const artistCls = ev.artist==="X" ? "aX" : (ev.artist==="Y" ? "aY" : "aZ");
    const tagCls =
      ev.status==="SHOW" ? "tShow" :
      ev.status==="RESERVADO" ? "tReservado" :
      ev.status==="HOLD" ? "tHold" : "tCancel";

    return `
      <div class="eventPill ${artistCls}" data-id="${ev.id}">
        <div class="eventLeft">
          <div class="eventName">${escapeHtml(ev.title)}</div>
          <div class="eventMeta">${escapeHtml(ev.time)} ‚Ä¢ ${escapeHtml("Artista " + ev.artist)}</div>
        </div>
        <span class="tag ${tagCls}">${escapeHtml(ev.status)}</span>
      </div>
    `;
  }

  function eventsForDate(iso){
    return events.filter(e => e.date === iso)
                 .sort((a,b)=> (a.time||"").localeCompare(b.time||""));
  }

  function openCreate(dateISO){
    editingId = null;
    f_date.value = dateISO;
    f_time.value = "21:00";
    f_artist.value = "X";
    f_status.value = "RESERVADO";
    f_address.value = "";
    f_contratante.value = "";
    f_phone.value = "";
    f_contract.value = "NAO";
    f_notes.value = "";
    openModal("Novo compromisso");
  }

  function openEdit(id){
    const ev = events.find(e=>e.id===id);
    if(!ev) return;
    editingId = id;

    f_date.value = ev.date;
    f_time.value = ev.time || "21:00";
    f_artist.value = ev.artist || "X";
    f_status.value = ev.status || "RESERVADO";
    f_address.value = ev.address || "";
    f_contratante.value = ev.contratante || "";
    f_phone.value = ev.phone || "";
    f_contract.value = ev.contractSent || "NAO";
    f_notes.value = ev.notes || "";
    openModal("Gerenciar compromisso");
  }

  function saveVisual(){
    const base = {
      date: f_date.value,
      time: f_time.value,
      artist: f_artist.value,
      status: f_status.value,
      title: makeTitle(f_artist.value),
      address: f_address.value,
      contratante: f_contratante.value,
      phone: f_phone.value,
      contractSent: f_contract.value,
      notes: f_notes.value
    };

    if(!base.date){
      toast("‚ùå Selecione uma data");
      return;
    }

    setLoading(true);
    setTimeout(()=>{
      if(editingId){
        const idx = events.findIndex(e=>e.id===editingId);
        if(idx>=0) events[idx] = { ...events[idx], ...base };
        toast("‚úÖ Atualizado (visual)");
      }else{
        events.push({ id:"e"+Math.random().toString(16).slice(2), ...base });
        toast("‚úÖ Criado (visual)");
      }
      setLoading(false);
      close();
      render();
    }, 520);
  }

  function makeTitle(artist){
    return `Compromisso - Artista ${artist}`;
  }

  // NAV
  prev.addEventListener("click", ()=>{
    viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()-1, 1);
    render();
  });
  next.addEventListener("click", ()=>{
    viewDate = new Date(viewDate.getFullYear(), viewDate.getMonth()+1, 1);
    render();
  });
  btnToday.addEventListener("click", ()=>{
    viewDate = new Date();
    render();
    toast("üìÖ M√™s atual");
  });

  // Modal
  btnNew.addEventListener("click", ()=> openCreate(toISO(new Date())));
  btnSave.addEventListener("click", saveVisual);
  btnCancel.addEventListener("click", close);
  closeModal.addEventListener("click", close);
  overlay.addEventListener("click", (e)=>{
    if(e.target === overlay) close();
  });

  // Utils
  function toISO(d){
    const z = new Date(d);
    const y = z.getFullYear();
    const m = String(z.getMonth()+1).padStart(2,"0");
    const da = String(z.getDate()).padStart(2,"0");
    return `${y}-${m}-${da}`;
  }
  function addDays(iso, n){
    const d = new Date(iso+"T00:00:00");
    d.setDate(d.getDate()+n);
    return toISO(d);
  }
  function escapeHtml(s){
    return String(s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
  }

  // Start
  render();
</script>
</body>
</html>
