<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agenda | Nobreak Company - Redesign</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800;900&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

<style>
  @font-face{
    font-family:"Rokiest";
    src:url("https://raw.githubusercontent.com/WAYCOMPANYGG/roteiro/main/assets/fonts/Rokiest-Extrabold.otf") format("opentype");
    font-weight:800; font-display:swap;
  }

  :root{
    --bg:#0a0f1a;
    --bg-secondary:#111827;
    --surface:#1a1f2e;
    --surface-elevated:#252b3b;
    
    --border:rgba(255,255,255,.08);
    --border-light:rgba(255,255,255,.12);
    --border-hover:rgba(255,0,128,.5);
    
    --text:#f8fafc;
    --text-secondary:#e2e8f0;
    --text-muted:#94a3b8;
    --text-dim:#64748b;
    
    --primary:#FF0080;
    --primary-light:#FF3399;
    --primary-dark:#CC0066;
    --accent:#00F0FF;
    --accent-light:#22d3ee;
    --success:#10b981;
    --warning:#f59e0b;
    --danger:#ef4444;
    
    --shadow-sm:0 2px 8px rgba(0,0,0,.3);
    --shadow-md:0 8px 24px rgba(0,0,0,.4);
    --shadow-lg:0 20px 40px rgba(0,0,0,.5);
    
    --radius-lg:16px;
    --radius-md:12px;
    --radius-sm:8px;
  }

  *{box-sizing:border-box; margin:0; padding:0}
  
  html,body{
    height:100%;
    font-family:'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    color:var(--text);
    background:var(--bg);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(0, 240, 255, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .container{
    max-width:1600px;
    margin:0 auto;
    padding:24px;
    animation:fadeIn .6s ease;
    position:relative;
    z-index:1;
  }

  @keyframes fadeIn{
    from{ opacity:0; transform:translateY(10px); }
    to{ opacity:1; transform:translateY(0); }
  }

  /* Header */
  .header{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:24px 32px;
    margin-bottom:24px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:20px;
    flex-wrap:wrap;
    animation:slideDown .5s ease;
  }

  @keyframes slideDown{
    from{ opacity:0; transform:translateY(-20px); }
    to{ opacity:1; transform:translateY(0); }
  }

  .brand{
    display:flex;
    align-items:center;
    gap:20px;
  }

  .logo{
    display:flex;
    align-items:center;
    gap:2px;
    font-family:'Rokiest', sans-serif;
    font-size:22px;
    letter-spacing:0.5px;
    color:var(--text);
  }

  .logo-k{position:relative; margin-right:-3px}

  .logo-lightning{
    position:absolute;
    right:-6px;
    top:50%;
    transform:translateY(-50%);
    width:16px;
    filter:drop-shadow(0 0 8px #ffd700);
  }

  .header-titles h1{
    font-family:'Space Grotesk', sans-serif;
    font-size:24px;
    font-weight:600;
    letter-spacing:-0.3px;
    margin-bottom:4px;
    color:var(--text);
  }

  .header-sub{
    font-size:13px;
    color:var(--text-dim);
    font-weight:500;
  }

  .header-actions{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
  }

  /* Search */
  .search{
    display:flex;
    align-items:center;
    gap:12px;
    padding:0 16px;
    height:44px;
    min-width:320px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--surface-elevated);
    transition:all .2s;
  }

  .search:focus-within{
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(255,0,128,.15);
  }

  .search svg{
    opacity:.5;
    transition:opacity .2s;
  }

  .search:focus-within svg{
    opacity:1;
  }

  .search input{
    flex:1;
    border:0;
    outline:0;
    background:transparent;
    color:var(--text);
    font-weight:500;
    font-size:14px;
  }

  .search input::placeholder{
    color:var(--text-dim);
  }

  /* Buttons */
  .btn{
    height:44px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--surface-elevated);
    color:var(--text);
    font-weight:600;
    font-size:14px;
    padding:0 20px;
    cursor:pointer;
    transition:all .2s;
    display:inline-flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
  }

  .btn:hover{
    transform:translateY(-1px);
    border-color:var(--border-light);
    box-shadow:var(--shadow-sm);
  }

  .btnPrimary{
    background:linear-gradient(135deg, var(--primary), #7928CA);
    border-color:transparent;
    color:#fff;
    font-weight:700;
    box-shadow:0 5px 20px rgba(255,0,128,0.3);
  }

  .btnPrimary:hover{
    transform:translateY(-2px);
    box-shadow:0 10px 30px rgba(255,0,128,0.5);
  }

  /* Toolbar */
  .toolbar{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:20px 24px;
    margin-bottom:24px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    flex-wrap:wrap;
    animation:slideUp .6s ease .1s both;
  }

  @keyframes slideUp{
    from{ opacity:0; transform:translateY(20px); }
    to{ opacity:1; transform:translateY(0); }
  }

  .toolbar-left,
  .toolbar-center,
  .toolbar-right{
    display:flex;
    align-items:center;
    gap:12px;
  }

  .select{
    height:40px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--surface-elevated);
    color:var(--text);
    padding:0 40px 0 16px;
    outline:none;
    font-weight:600;
    font-size:14px;
    cursor:pointer;
    transition:all .2s;
    appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat:no-repeat;
    background-position:right 12px center;
  }

  .select:hover{
    border-color:var(--border-light);
  }

  .select:focus{
    border-color:var(--primary);
    box-shadow:0 0 0 3px rgba(255,0,128,.15);
  }

  /* Chips */
  .chips{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }

  .chip{
    height:32px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--surface-elevated);
    padding:0 14px;
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight:600;
    font-size:12px;
    cursor:pointer;
    transition:all .2s;
  }

  .chip:hover{
    transform:translateY(-1px);
    border-color:var(--border-light);
  }

  .chip .dot{
    width:8px;
    height:8px;
    border-radius:50%;
    background:currentColor;
  }

  .chip.active{
    border-color:var(--primary);
    background:rgba(255,0,128,.15);
  }

  /* Month Navigation */
  .month-nav{
    display:flex;
    align-items:center;
    gap:16px;
  }

  .month-title{
    font-family:'Space Grotesk', sans-serif;
    font-size:20px;
    font-weight:600;
    min-width:180px;
    text-align:center;
    color:var(--text);
  }

  .nav-btn{
    width:40px;
    height:40px;
    border-radius:var(--radius-sm);
    border:1px solid var(--border);
    background:var(--surface-elevated);
    display:grid;
    place-items:center;
    cursor:pointer;
    transition:all .2s;
    font-size:18px;
  }

  .nav-btn:hover{
    transform:translateY(-1px);
    border-color:var(--primary);
    background:var(--surface);
    color:var(--primary);
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 16px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--surface-elevated);
    color:var(--text-secondary);
    font-weight:600;
    font-size:13px;
  }

  /* Calendar */
  .calendar{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    overflow:hidden;
    animation:slideUp .6s ease .2s both;
  }

  .weekdays{
    display:grid;
    grid-template-columns:repeat(7, 1fr);
    background:var(--surface-elevated);
    border-bottom:1px solid var(--border);
  }

  .weekdays div{
    padding:16px;
    font-size:12px;
    font-weight:700;
    color:var(--text-dim);
    letter-spacing:0.5px;
    text-transform:uppercase;
    text-align:center;
  }

  .days{
    display:grid;
    grid-template-columns:repeat(7, 1fr);
    min-height:600px;
    gap:1px;
    background:var(--border);
  }

  .day{
    padding:12px;
    background:var(--surface);
    min-height:120px;
    transition:all .25s cubic-bezier(.4,0,.2,1);
    overflow-y:auto;
    scrollbar-width:none;
    -ms-overflow-style:none;
    position:relative;
  }

  .day::-webkit-scrollbar{
    display:none;
  }

  /* Animated + button */
  .day::after{
    content:'Ôºã';
    position:absolute;
    top:10px;
    right:10px;
    width:32px;
    height:32px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--primary), var(--accent));
    color:#fff;
    font-size:20px;
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    transform:scale(0.5) rotate(-180deg);
    transition:all .4s cubic-bezier(.34,1.56,.64,1);
    cursor:pointer;
    pointer-events:none;
    box-shadow:0 4px 12px rgba(255,0,128,.4);
    z-index:20;
  }

  .day:hover::after{
    opacity:1;
    transform:scale(1) rotate(0deg);
    pointer-events:auto;
    animation:plusPulse 2s ease-in-out infinite;
  }

  @keyframes plusPulse{
    0%, 100%{ 
      box-shadow:0 4px 12px rgba(255,0,128,.4),
                 0 0 0 0 rgba(255,0,128,.4);
    }
    50%{ 
      box-shadow:0 6px 16px rgba(255,0,128,.6),
                 0 0 0 8px rgba(255,0,128,0);
    }
  }

  .day:hover{
    background:var(--surface-elevated);
    transform:scale(1.02);
    z-index:10;
    box-shadow:0 8px 24px rgba(0,0,0,.3);
  }

  .day.weekend{
    background:rgba(255,0,128,.03);
    border:1px solid rgba(255,0,128,.1);
  }

  .day.weekend:hover{
    background:rgba(255,0,128,.05);
    border-color:rgba(255,0,128,.15);
  }

  .day.weekend .day-number{
    color:var(--text-secondary);
    font-weight:700;
  }

  .day.weekend::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    height:2px;
    background:linear-gradient(90deg, var(--primary), var(--accent));
    opacity:.2;
  }

  .day-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
    padding-bottom:6px;
    border-bottom:1px solid var(--border);
  }

  .day-number{
    font-weight:700;
    font-size:14px;
    color:var(--text-secondary);
    transition:all .2s;
  }

  .day:hover .day-number{
    transform:scale(1.1);
    color:var(--primary);
  }

  .day.other-month .day-number{
    color:var(--text-dim);
    opacity:.5;
  }

  .day.today{
    background:rgba(255,0,128,.05);
  }

  .day.today .day-number{
    color:var(--primary);
    font-weight:800;
  }

  .today-tag{
    font-size:10px;
    font-weight:700;
    padding:4px 8px;
    border-radius:999px;
    background:rgba(255,0,128,.15);
    color:var(--primary);
    border:1px solid rgba(255,0,128,.3);
    animation:pulse 2s ease-in-out infinite;
    transition:all .3s cubic-bezier(.4,0,.2,1);
    position:relative;
  }

  .day:hover .today-tag{
    transform:translateX(-40px);
    opacity:.6;
  }

  @keyframes pulse{
    0%, 100%{ opacity:1; }
    50%{ opacity:.8; }
  }

  /* Events */
  .event{
    position:relative;
    border-radius:8px;
    background:var(--accent);
    padding:10px 12px;
    margin-bottom:6px;
    cursor:pointer;
    transition:all .25s cubic-bezier(.4,0,.2,1);
    font-size:12px;
    box-shadow:0 2px 8px rgba(0,0,0,.2);
    overflow:hidden;
  }

  .event::before{
    content:'';
    position:absolute;
    inset:0;
    background:linear-gradient(135deg, rgba(255,255,255,.15), transparent 60%);
    opacity:0;
    transition:opacity .25s;
  }

  .event:hover{
    transform:translateY(-4px) scale(1.03);
    box-shadow:0 8px 24px rgba(0,0,0,.4);
  }

  .event:hover::before{
    opacity:1;
  }

  .event:active{
    transform:translateY(-2px) scale(1.01);
  }

  .event-title{
    font-weight:700;
    font-size:12px;
    color:#ffffff;
    margin-bottom:6px;
    line-height:1.3;
    text-shadow:0 1px 2px rgba(0,0,0,.2);
  }

  .event-meta{
    display:flex;
    gap:6px;
    flex-wrap:wrap;
    color:rgba(255,255,255,.9);
    font-size:10px;
    font-weight:600;
  }

  .event-meta span{
    display:inline-flex;
    align-items:center;
    gap:4px;
    padding:2px 6px;
    border-radius:4px;
    background:rgba(0,0,0,.15);
    backdrop-filter:blur(10px);
  }

  /* Modal Overlay */
  .modal-overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(12px);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
    padding:20px;
    animation:fadeInOverlay 0.3s ease;
  }

  @keyframes fadeInOverlay{
    from{ opacity:0; }
    to{ opacity:1; }
  }

  .modal-overlay.show{
    display:flex;
  }

  .modal{
    background:var(--surface);
    border-radius:30px;
    width:100%;
    max-width:1100px;
    max-height:90vh;
    overflow-y:auto;
    padding:0;
    animation:modalPop 0.5s cubic-bezier(0.16,1,0.3,1);
    box-shadow:0 20px 60px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.1);
  }

  @keyframes modalPop{
    from{ opacity:0; transform:scale(0.9) translateY(30px); }
    to{ opacity:1; transform:scale(1) translateY(0); }
  }

  .modal::-webkit-scrollbar{
    width:10px;
  }

  .modal::-webkit-scrollbar-track{
    background:transparent;
  }

  .modal::-webkit-scrollbar-thumb{
    background:rgba(255,255,255,0.1);
    border-radius:10px;
  }

  .modal::-webkit-scrollbar-thumb:hover{
    background:rgba(255,0,128,0.3);
  }

  /* Modal Header */
  .modal-header{
    background:linear-gradient(135deg, var(--primary) 0%, #7928CA 100%);
    padding:40px;
    border-radius:30px 30px 0 0;
    position:relative;
    overflow:hidden;
  }

  .modal-header::before{
    content:'';
    position:absolute;
    top:-50%;
    right:-10%;
    width:500px;
    height:500px;
    background:radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    border-radius:50%;
    animation:rotateGlow 20s linear infinite;
  }

  @keyframes rotateGlow{
    from{ transform:rotate(0deg); }
    to{ transform:rotate(360deg); }
  }

  .modal-header-content{
    display:flex;
    justify-content:space-between;
    align-items:center;
    position:relative;
  }

  .modal-title-section{}

  .modal-title{
    font-size:32px;
    font-weight:900;
    margin-bottom:8px;
    text-shadow:2px 2px 10px rgba(0,0,0,0.3);
  }

  .modal-subtitle{
    font-size:16px;
    opacity:0.9;
    font-weight:600;
  }

  .close-btn{
    width:48px;
    height:48px;
    border-radius:50%;
    background:rgba(255,255,255,0.2);
    backdrop-filter:blur(10px);
    border:2px solid rgba(255,255,255,0.3);
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    font-weight:700;
    transition:all 0.3s ease;
  }

  .close-btn:hover{
    background:rgba(255,255,255,0.3);
    transform:rotate(90deg) scale(1.1);
    border-color:rgba(255,255,255,0.5);
  }

  /* Modal Body */
  .modal-body{
    padding:40px;
  }

  /* Form Sections */
  .form-section{
    background:rgba(255,255,255,0.03);
    border-radius:20px;
    padding:30px;
    margin-bottom:25px;
    border:1px solid rgba(255,255,255,0.05);
    position:relative;
    overflow:hidden;
    transition:all 0.3s ease;
  }

  .form-section::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:3px;
    background:linear-gradient(90deg, var(--primary), var(--accent));
  }

  .form-section:hover{
    background:rgba(255,255,255,0.05);
    border-color:rgba(255,0,128,0.2);
    transform:translateY(-2px);
  }

  .section-header{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:25px;
    padding-bottom:15px;
    border-bottom:1px solid rgba(255,255,255,0.1);
  }

  .section-icon{
    width:40px;
    height:40px;
    border-radius:12px;
    background:linear-gradient(135deg, var(--primary), var(--accent));
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:20px;
    box-shadow:0 5px 15px rgba(255,0,128,0.3);
  }

  .section-label{
    font-size:18px;
    font-weight:800;
    color:var(--text);
  }

  /* Form */
  .form-row{
    display:grid;
    gap:20px;
    margin-bottom:12px;
  }

  .form-row.cols-2{grid-template-columns:1fr 1fr}
  .form-row.cols-3{grid-template-columns:repeat(3, 1fr)}
  .form-row.cols-4{grid-template-columns:repeat(4, 1fr)}
  .form-row.cols-5{grid-template-columns:repeat(5, 1fr)}

  @media(max-width:768px){
    .form-row.cols-2,
    .form-row.cols-3,
    .form-row.cols-4,
    .form-row.cols-5{
      grid-template-columns:1fr;
    }
  }

  .field{
    display:flex;
    flex-direction:column;
    gap:10px;
    min-width:0;
    overflow:hidden;
    position:relative;
  }

  .field label{
    font-size:12px;
    font-weight:700;
    color:var(--text-muted);
    letter-spacing:0.5px;
    text-transform:uppercase;
    display:flex;
    align-items:center;
    gap:6px;
  }

  .field-highlight label{
    color:var(--primary);
    font-size:13px;
  }

  .input,
  .textarea,
  select.input{
    width:100%;
    padding:14px 18px;
    background:rgba(255,255,255,0.05);
    border:2px solid rgba(255,255,255,0.1);
    border-radius:12px;
    color:var(--text);
    font-family:'Poppins', sans-serif;
    font-weight:600;
    font-size:15px;
    transition:all 0.3s ease;
    outline:none;
  }

  .input:hover,
  .textarea:hover,
  select.input:hover{
    background:rgba(255,255,255,0.08);
    border-color:rgba(255,255,255,0.15);
  }

  .input:focus,
  .textarea:focus,
  select.input:focus{
    background:rgba(255,255,255,0.08);
    border-color:var(--primary);
    box-shadow:0 0 0 4px rgba(255,0,128,0.15);
    transform:translateY(-2px);
  }

  .field-highlight .input,
  .field-highlight .textarea,
  .field-highlight select.input{
    border-color:rgba(255,0,128,0.3);
    font-weight:700;
    font-size:16px;
  }

  .field-highlight .input:focus,
  .field-highlight .textarea:focus,
  .field-highlight select.input:focus{
    border-color:var(--primary);
    box-shadow:0 0 0 4px rgba(255,0,128,0.2), 0 5px 15px rgba(255,0,128,0.2);
  }

  .textarea{
    min-height:80px;
    resize:vertical;
    font-size:14px;
    line-height:1.6;
  }

  select.input{
    appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%238B92B3' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat:no-repeat;
    background-position:right 15px center;
    background-size:18px;
    padding-right:45px;
    cursor:pointer;
  }

  select.input option{
    background:var(--surface);
    color:var(--text);
    padding:12px;
    font-weight:600;
  }

  /* Animated underline */
  .field::after{
    content:'';
    position:absolute;
    bottom:0;
    left:0;
    width:0;
    height:2px;
    background:linear-gradient(90deg, var(--primary), var(--accent));
    transition:width 0.4s ease;
  }

  .field:focus-within::after{
    width:100%;
  }

  /* Toggle */
  .toggle-field{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:20px;
    border-radius:15px;
    background:rgba(255,255,255,0.03);
    border:2px solid rgba(255,255,255,0.08);
    transition:all 0.3s ease;
  }

  .toggle-field:hover{
    background:rgba(255,255,255,0.05);
    border-color:rgba(255,0,128,0.2);
  }

  .toggle-label{
    font-weight:700;
    font-size:15px;
    color:var(--text);
  }

  .toggle{
    width:60px;
    height:32px;
    border-radius:20px;
    background:rgba(255,255,255,0.1);
    border:2px solid rgba(255,255,255,0.2);
    position:relative;
    cursor:pointer;
    transition:all 0.3s ease;
  }

  .toggle::after{
    content:'';
    position:absolute;
    top:3px;
    left:3px;
    width:22px;
    height:22px;
    border-radius:50%;
    background:#fff;
    transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow:0 2px 6px rgba(0,0,0,0.3);
  }

  .toggle.on{
    background:linear-gradient(135deg, var(--primary), var(--accent));
    border-color:transparent;
    box-shadow:0 0 20px rgba(255,0,128,0.4);
  }

  .toggle.on::after{
    left:31px;
  }

  /* Actions */
  .modal-actions{
    display:flex;
    gap:15px;
    margin-top:40px;
    padding-top:30px;
    border-top:2px solid rgba(255,255,255,0.1);
  }

  .btnDanger{
    background:rgba(239,68,68,.15);
    border:2px solid rgba(239,68,68,.3);
    color:var(--danger);
    padding:0 32px;
    height:48px;
    border-radius:12px;
    font-weight:800;
    font-size:15px;
    cursor:pointer;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    gap:10px;
  }

  .btnDanger:hover{
    background:rgba(239,68,68,.25);
    border-color:var(--danger);
    transform:translateY(-2px);
  }

  .btnSecondary{
    background:rgba(255,255,255,0.05);
    color:var(--text);
    border:2px solid rgba(255,255,255,0.1);
    padding:0 32px;
    height:48px;
    border-radius:12px;
    font-weight:800;
    font-size:15px;
    cursor:pointer;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    gap:10px;
  }

  .btnSecondary:hover{
    background:rgba(255,255,255,0.08);
    border-color:rgba(255,255,255,0.2);
    transform:translateY(-2px);
  }

  .btnSave{
    flex:1;
    background:linear-gradient(135deg, var(--primary), #7928CA);
    color:white;
    border:none;
    padding:0 32px;
    height:48px;
    border-radius:12px;
    font-weight:800;
    font-size:15px;
    cursor:pointer;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    box-shadow:0 5px 20px rgba(255,0,128,0.3);
  }

  .btnSave:hover{
    transform:translateY(-3px);
    box-shadow:0 10px 30px rgba(255,0,128,0.5);
  }

  /* Animations */
  .form-section:nth-child(1){ animation:slideUp 0.6s ease 0.1s both; }
  .form-section:nth-child(2){ animation:slideUp 0.6s ease 0.2s both; }
  .form-section:nth-child(3){ animation:slideUp 0.6s ease 0.3s both; }
  .form-section:nth-child(4){ animation:slideUp 0.6s ease 0.4s both; }

  /* Dashboard Analytics */
  .dashboard-section{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:40px;
    margin-top:30px;
    animation:slideUp .6s ease .4s both;
  }

  /* Notification Badge */
  .notification-badge{
    position:absolute;
    top:-8px;
    right:-8px;
    background:linear-gradient(135deg, var(--danger), #FF6B00);
    color:white;
    font-size:11px;
    font-weight:900;
    padding:4px 8px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(239,68,68,0.4);
    animation:pulse 2s ease-in-out infinite;
  }

  /* Solicita√ß√µes Section */
  .solicitacoes-section{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:40px;
    margin-top:30px;
    animation:slideUp .6s ease .3s both;
  }

  .solicitacoes-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:40px;
    flex-wrap:wrap;
    gap:20px;
  }

  .solicitacoes-title{
    font-family:'Space Grotesk', sans-serif;
    font-size:32px;
    font-weight:900;
    background:linear-gradient(135deg, var(--warning), #FF6B00);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:8px;
  }

  .solicitacoes-subtitle{
    font-size:16px;
    color:var(--text-muted);
    font-weight:600;
  }

  /* Empty State */
  .empty-state{
    text-align:center;
    padding:80px 40px;
    background:rgba(255,255,255,0.02);
    border-radius:20px;
    border:2px dashed rgba(255,255,255,0.1);
  }

  /* Solicita√ß√£o Card */
  .solicitacao-card{
    background:linear-gradient(135deg, rgba(255,184,0,0.1), rgba(255,107,0,0.1));
    border-radius:20px;
    padding:30px;
    margin-bottom:20px;
    border:2px solid rgba(255,184,0,0.2);
    transition:all 0.3s ease;
  }

  .solicitacao-card:hover{
    transform:translateY(-3px);
    border-color:rgba(255,184,0,0.4);
    box-shadow:0 10px 30px rgba(255,184,0,0.2);
  }

  .solicitacao-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom:20px;
    flex-wrap:wrap;
    gap:15px;
  }

  .solicitacao-info h3{
    font-size:22px;
    font-weight:900;
    color:var(--text);
    margin-bottom:8px;
  }

  .solicitacao-meta{
    font-size:14px;
    color:var(--text-muted);
    font-weight:600;
  }

  .solicitacao-status{
    padding:8px 16px;
    border-radius:20px;
    font-size:12px;
    font-weight:800;
    text-transform:uppercase;
  }

  .solicitacao-status.pendente{
    background:rgba(255,184,0,0.2);
    color:var(--warning);
    border:2px solid rgba(255,184,0,0.3);
  }

  .solicitacao-status.aprovado{
    background:rgba(0,255,136,0.2);
    color:var(--success);
    border:2px solid rgba(0,255,136,0.3);
  }

  .solicitacao-status.rejeitado{
    background:rgba(239,68,68,0.2);
    color:var(--danger);
    border:2px solid rgba(239,68,68,0.3);
  }

  .solicitacao-detalhes{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
    gap:15px;
    margin-bottom:20px;
  }

  .solicitacao-detalhe{
    background:rgba(255,255,255,0.05);
    padding:15px;
    border-radius:12px;
  }

  .solicitacao-detalhe-label{
    font-size:11px;
    color:var(--text-muted);
    font-weight:700;
    text-transform:uppercase;
    margin-bottom:8px;
    letter-spacing:0.5px;
  }

  .solicitacao-detalhe-value{
    font-size:16px;
    font-weight:900;
    color:var(--text);
  }

  .solicitacao-actions{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
  }

  /* Link Modal */
  .link-modal-content{
    background:var(--surface-elevated);
    border-radius:20px;
    padding:30px;
    margin-top:20px;
    border:2px solid rgba(255,184,0,0.2);
  }

  .link-box{
    background:rgba(255,255,255,0.05);
    border:2px solid rgba(255,184,0,0.2);
    border-radius:12px;
    padding:20px;
    margin:20px 0;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:15px;
  }

  .link-url{
    flex:1;
    font-family:'Courier New', monospace;
    font-size:13px;
    font-weight:700;
    color:var(--accent);
    word-break:break-all;
  }

  .btn-copy{
    padding:12px 24px;
    background:linear-gradient(135deg, var(--warning), #FF6B00);
    border:none;
    border-radius:10px;
    color:white;
    font-weight:800;
    font-size:14px;
    cursor:pointer;
    transition:all 0.3s ease;
    white-space:nowrap;
  }

  .btn-copy:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(255,184,0,0.3);
  }

  /* Dashboard Analytics */

  .dashboard-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:40px;
    flex-wrap:wrap;
    gap:20px;
  }

  .dashboard-title{
    font-family:'Space Grotesk', sans-serif;
    font-size:32px;
    font-weight:900;
    background:linear-gradient(135deg, var(--accent), #0080FF);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:8px;
  }

  .dashboard-subtitle{
    font-size:16px;
    color:var(--text-muted);
    font-weight:600;
  }

  /* Quick Stats */
  .quick-stats{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
    gap:20px;
    margin-bottom:40px;
  }

  .quick-stat-card{
    background:linear-gradient(135deg, rgba(0,240,255,0.1), rgba(0,128,255,0.1));
    border-radius:20px;
    padding:30px;
    border:2px solid rgba(0,240,255,0.2);
    transition:all 0.3s ease;
    text-align:center;
  }

  .quick-stat-card:hover{
    transform:translateY(-5px);
    border-color:rgba(0,240,255,0.4);
    box-shadow:0 10px 30px rgba(0,240,255,0.3);
  }

  .quick-stat-icon{
    font-size:48px;
    margin-bottom:15px;
  }

  .quick-stat-value{
    font-size:36px;
    font-weight:900;
    background:linear-gradient(135deg, var(--accent), #0080FF);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:10px;
  }

  .quick-stat-label{
    font-size:14px;
    font-weight:700;
    color:var(--text-muted);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  /* Dashboard Tabs */
  .dashboard-tabs{
    display:flex;
    gap:10px;
    margin-bottom:30px;
    flex-wrap:wrap;
  }

  .dashboard-tab{
    padding:14px 28px;
    background:rgba(255,255,255,0.03);
    border:2px solid rgba(255,255,255,0.1);
    border-radius:12px;
    font-weight:700;
    font-size:15px;
    cursor:pointer;
    transition:all 0.3s ease;
  }

  .dashboard-tab:hover{
    background:rgba(255,255,255,0.05);
    border-color:rgba(0,240,255,0.3);
  }

  .dashboard-tab.active{
    background:linear-gradient(135deg, var(--accent), #0080FF);
    border-color:transparent;
    color:white;
    box-shadow:0 5px 20px rgba(0,240,255,0.3);
  }

  /* Charts Grid */
  .charts-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(500px, 1fr));
    gap:30px;
    margin-bottom:30px;
  }

  .chart-box{
    background:var(--surface-elevated);
    border-radius:20px;
    padding:30px;
    border:1px solid rgba(255,255,255,0.05);
    transition:all 0.3s ease;
  }

  .chart-box:hover{
    transform:translateY(-3px);
    border-color:rgba(0,240,255,0.2);
  }

  .chart-title{
    font-size:20px;
    font-weight:900;
    margin-bottom:25px;
    display:flex;
    align-items:center;
    gap:10px;
    color:var(--text);
  }

  .chart-canvas{
    position:relative;
    height:350px;
  }

  /* Rankings */
  .ranking-list{
    display:flex;
    flex-direction:column;
    gap:15px;
  }

  .ranking-item{
    display:flex;
    align-items:center;
    gap:20px;
    padding:20px;
    background:rgba(255,255,255,0.03);
    border-radius:15px;
    border:2px solid rgba(255,255,255,0.05);
    transition:all 0.3s ease;
  }

  .ranking-item:hover{
    background:rgba(255,255,255,0.05);
    border-color:rgba(0,240,255,0.2);
    transform:translateX(5px);
  }

  .ranking-position{
    width:50px;
    height:50px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--accent), #0080FF);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:22px;
    font-weight:900;
    color:white;
    box-shadow:0 4px 12px rgba(0,240,255,0.3);
  }

  .ranking-position.top1{
    background:linear-gradient(135deg, #FFD700, #FFA500);
  }

  .ranking-position.top2{
    background:linear-gradient(135deg, #C0C0C0, #A8A8A8);
  }

  .ranking-position.top3{
    background:linear-gradient(135deg, #CD7F32, #B8860B);
  }

  .ranking-info{
    flex:1;
  }

  .ranking-name{
    font-size:18px;
    font-weight:800;
    color:var(--text);
    margin-bottom:5px;
  }

  .ranking-detail{
    font-size:13px;
    color:var(--text-muted);
    font-weight:600;
  }

  .ranking-value{
    font-size:24px;
    font-weight:900;
    background:linear-gradient(135deg, var(--accent), #0080FF);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
  }

  /* Map Visualization */
  .map-container{
    background:rgba(0,240,255,0.05);
    border-radius:20px;
    padding:40px;
    border:2px solid rgba(0,240,255,0.1);
    text-align:center;
  }

  .map-icon{
    font-size:120px;
    margin-bottom:20px;
    opacity:0.8;
  }

  .map-title{
    font-size:24px;
    font-weight:900;
    color:var(--text);
    margin-bottom:30px;
  }

  .states-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(120px, 1fr));
    gap:15px;
    margin-top:30px;
  }

  .state-badge{
    padding:15px;
    background:rgba(255,255,255,0.05);
    border-radius:12px;
    border:2px solid rgba(255,255,255,0.1);
    font-weight:700;
    font-size:14px;
    transition:all 0.3s ease;
  }

  .state-badge.visited{
    background:linear-gradient(135deg, rgba(0,255,136,0.15), rgba(0,212,255,0.15));
    border-color:var(--success);
  }

  .state-badge.not-visited{
    opacity:0.3;
  }

  .state-badge:hover{
    transform:scale(1.05);
  }

  /* Insights Panel */
  .insights-panel{
    background:linear-gradient(135deg, rgba(0,240,255,0.1), rgba(0,128,255,0.1));
    border-radius:20px;
    padding:30px;
    border:2px solid rgba(0,240,255,0.2);
    margin-top:30px;
  }

  .insights-panel h3{
    font-size:22px;
    font-weight:900;
    margin-bottom:20px;
    display:flex;
    align-items:center;
    gap:12px;
    color:var(--accent);
  }

  .insight-row{
    background:rgba(255,255,255,0.05);
    border-radius:12px;
    padding:18px;
    margin-bottom:12px;
    border:1px solid rgba(255,255,255,0.1);
  }

  .insight-row p{
    font-size:15px;
    line-height:1.6;
    font-weight:600;
    color:var(--text-secondary);
  }

  @media(max-width:1024px){
    .charts-grid{
      grid-template-columns:1fr;
    }
  }

  @media(max-width:768px){
    .dashboard-section{
      padding:25px 20px;
    }

    .dashboard-header{
      flex-direction:column;
      align-items:stretch;
    }

    .quick-stats{
      grid-template-columns:repeat(2, 1fr);
    }

    .dashboard-tabs{
      flex-direction:column;
    }

    .dashboard-tab{
      width:100%;
      text-align:center;
    }
  }

  /* Comparativo de Artistas */
  .comparativo-section{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:40px;
    margin-top:30px;
    animation:slideUp .6s ease .3s both;
  }

  .comparativo-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:40px;
    flex-wrap:wrap;
    gap:30px;
  }

  .comparativo-title{
    font-family:'Space Grotesk', sans-serif;
    font-size:32px;
    font-weight:900;
    background:linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    margin-bottom:8px;
  }

  .comparativo-subtitle{
    font-size:16px;
    color:var(--text-muted);
    font-weight:600;
  }

  .comparativo-selectors{
    display:flex;
    align-items:center;
    gap:20px;
    flex-wrap:wrap;
  }

  .artist-select{
    height:48px;
    border-radius:12px;
    border:2px solid var(--border);
    background:var(--surface-elevated);
    color:var(--text);
    padding:0 40px 0 20px;
    outline:none;
    font-weight:700;
    font-size:15px;
    cursor:pointer;
    transition:all .3s;
    appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 20 20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%238B92B3' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat:no-repeat;
    background-position:right 15px center;
    min-width:180px;
  }

  .artist-select:hover{
    border-color:var(--primary);
    background:var(--surface);
  }

  .artist-select:focus{
    border-color:var(--primary);
    box-shadow:0 0 0 4px rgba(255,0,128,0.15);
  }

  .comparison-grid{
    display:grid;
    grid-template-columns:1fr auto 1fr;
    gap:40px;
    align-items:start;
    margin-bottom:40px;
  }

  .artist-column{
    background:linear-gradient(135deg, rgba(255,0,128,0.05), rgba(121,40,202,0.05));
    border-radius:20px;
    padding:30px;
    border:2px solid rgba(255,0,128,0.2);
    transition:all 0.3s ease;
  }

  .artist-column:hover{
    transform:translateY(-5px);
    border-color:rgba(255,0,128,0.4);
    box-shadow:0 10px 30px rgba(255,0,128,0.2);
  }

  .artist-column.winner{
    border-color:var(--success);
    background:linear-gradient(135deg, rgba(0,255,136,0.1), rgba(0,212,255,0.1));
    box-shadow:0 0 30px rgba(0,255,136,0.3);
  }

  .artist-name{
    font-size:24px;
    font-weight:900;
    margin-bottom:25px;
    display:flex;
    align-items:center;
    gap:12px;
  }

  .winner-badge{
    background:linear-gradient(135deg, var(--success), #00D4FF);
    color:white;
    padding:6px 14px;
    border-radius:20px;
    font-size:12px;
    font-weight:800;
    box-shadow:0 4px 12px rgba(0,255,136,0.3);
  }

  .stats-list{
    display:flex;
    flex-direction:column;
    gap:15px;
  }

  .stat-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:15px;
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.05);
  }

  .stat-label{
    font-size:14px;
    font-weight:700;
    color:var(--text-muted);
    text-transform:uppercase;
    letter-spacing:0.5px;
  }

  .stat-value{
    font-size:24px;
    font-weight:900;
    color:var(--text);
  }

  .stat-value.highlight{
    background:linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    font-size:28px;
  }

  .vs-divider{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:20px;
  }

  .vs-circle{
    width:80px;
    height:80px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--primary), var(--accent));
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    font-weight:900;
    color:white;
    box-shadow:0 8px 24px rgba(255,0,128,0.4);
    animation:pulse 2s ease-in-out infinite;
  }

  .difference-cards{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:20px;
    margin-top:40px;
  }

  .difference-card{
    background:var(--surface-elevated);
    border-radius:15px;
    padding:25px;
    border:2px solid rgba(255,255,255,0.05);
    transition:all 0.3s ease;
  }

  .difference-card:hover{
    transform:translateY(-3px);
    border-color:rgba(255,0,128,0.2);
  }

  .difference-card-title{
    font-size:13px;
    font-weight:700;
    color:var(--text-muted);
    text-transform:uppercase;
    margin-bottom:15px;
    letter-spacing:0.5px;
  }

  .difference-value{
    font-size:32px;
    font-weight:900;
    margin-bottom:10px;
  }

  .difference-value.positive{
    color:var(--success);
  }

  .difference-value.negative{
    color:var(--danger);
  }

  .difference-text{
    font-size:14px;
    color:var(--text-muted);
    font-weight:600;
  }

  .insights-box{
    background:linear-gradient(135deg, #7928CA 0%, var(--primary) 100%);
    border-radius:20px;
    padding:30px;
    margin-top:30px;
    box-shadow:0 10px 30px rgba(121,40,202,0.3);
  }

  .insights-box h3{
    font-size:22px;
    font-weight:900;
    margin-bottom:20px;
    display:flex;
    align-items:center;
    gap:12px;
  }

  .insight-item{
    background:rgba(255,255,255,0.1);
    backdrop-filter:blur(10px);
    border-radius:12px;
    padding:18px;
    margin-bottom:12px;
    border:1px solid rgba(255,255,255,0.2);
  }

  .insight-item p{
    font-size:15px;
    line-height:1.6;
    font-weight:600;
    opacity:0.95;
  }

  @media(max-width:1024px){
    .comparison-grid{
      grid-template-columns:1fr;
      gap:30px;
    }

    .vs-divider{
      order:-1;
    }

    .vs-circle{
      transform:rotate(90deg);
    }
  }

  @media(max-width:768px){
    .comparativo-section{
      padding:25px 20px;
    }

    .comparativo-header{
      flex-direction:column;
      align-items:stretch;
    }

    .comparativo-selectors{
      flex-direction:column;
      width:100%;
    }

    .artist-select{
      width:100%;
    }

    .difference-cards{
      grid-template-columns:1fr;
    }
  }

  /* Responsive */
  @media(max-width:1024px){
    .search{
      min-width:280px;
    }
  }

  @media(max-width:768px){
    .container{
      padding:16px;
    }

    .header{
      padding:16px 20px;
      flex-direction:column;
      align-items:stretch;
    }

    .brand{
      flex-direction:column;
      gap:12px;
    }

    .header-actions{
      width:100%;
    }

    .search{
      width:100%;
      min-width:auto;
    }

    .toolbar{
      padding:16px;
      flex-direction:column;
      align-items:stretch;
    }

    .toolbar-left,
    .toolbar-center,
    .toolbar-right{
      width:100%;
      justify-content:center;
    }

    .days{
      min-height:500px;
    }

    .day{
      min-height:100px;
      padding:8px;
    }

    .modal{
      border-radius:20px;
    }

    .modal-header{
      padding:30px 20px;
      border-radius:20px 20px 0 0;
    }

    .modal-title{
      font-size:24px;
    }

    .modal-body{
      padding:25px 20px;
    }

    .form-section{
      padding:20px;
    }

    .modal-actions{
      flex-direction:column;
    }

    .btnDanger,
    .btnSecondary,
    .btnSave{
      width:100%;
      justify-content:center;
    }
  }
</style>
</head>

<body>
<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="brand">
      <div class="logo">
        <span>NOBREA</span>
        <span class="logo-k">
          K
          <svg class="logo-lightning" viewBox="0 0 100 180" fill="none">
            <path d="M50 0L14 90H40L25 180L75 63H50L65 18L50 0Z" fill="#ffd700"/>
          </svg>
        </span>
      </div>
      <div class="header-titles">
        <h1>Agenda</h1>
        <div class="header-sub">Gest√£o de Compromissos</div>
      </div>
    </div>

    <div class="header-actions">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="2"/>
          <path d="M16 16L21 21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="searchInput" placeholder="Buscar evento, local, contratante..." />
      </div>

      <button class="btn" id="btnToday">Hoje</button>
      <button class="btn btnPrimary" id="btnNew">+ Novo</button>
      <button class="btn" onclick="toggleComparativo()" id="btnComparativo" style="background:linear-gradient(135deg, var(--primary), #7928CA); color:white; font-weight:700; border:none">
        ‚öîÔ∏è Comparativo
      </button>
      <button class="btn" onclick="toggleDashboard()" id="btnDashboard" style="background:linear-gradient(135deg, #00F0FF, #0080FF); color:white; font-weight:700; border:none">
        üìä Dashboard
      </button>
      <button class="btn" onclick="openSolicitacoesPanel()" id="btnSolicitacoes" style="background:linear-gradient(135deg, var(--success), #00D4FF); color:white; font-weight:700; border:none; position:relative">
        üìã Solicita√ß√µes
        <span id="solicitacoesBadge" class="notification-badge" style="display:none">0</span>
      </button>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="toolbar-left">
      <select id="artistFilter" class="select">
        <option value="ALL">Todos Artistas</option>
      </select>

      <div class="chips" id="statusChips">
        <!-- Chips will be inserted here -->
      </div>
    </div>

    <div class="toolbar-center">
      <div class="month-nav">
        <div class="nav-btn" id="prevMonth">‚Üê</div>
        <div class="month-title" id="monthLabel">‚Äî</div>
        <div class="nav-btn" id="nextMonth">‚Üí</div>
      </div>
    </div>

    <div class="toolbar-right">
      <div class="pill" id="countLabel">0 eventos</div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="calendar">
    <div class="weekdays">
      <div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div><div>Dom</div>
    </div>
    <div class="days" id="daysGrid"></div>
  </div>

  <!-- Comparativo de Artistas -->
  <div class="comparativo-section" id="comparativoSection" style="display:none">
    <div class="comparativo-header">
      <div>
        <h2 class="comparativo-title">‚öîÔ∏è Comparativo de Artistas</h2>
        <p class="comparativo-subtitle">An√°lise de Performance e Faturamento</p>
      </div>
      <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap">
        <div class="comparativo-selectors">
          <select id="artistA" class="artist-select">
            <option value="AX">Artista X</option>
            <option value="AY">Artista Y</option>
            <option value="AZ">Artista Z</option>
          </select>
          <span style="font-size:24px; font-weight:900; color:var(--text-muted)">VS</span>
          <select id="artistB" class="artist-select">
            <option value="AX">Artista X</option>
            <option value="AY" selected>Artista Y</option>
            <option value="AZ">Artista Z</option>
          </select>
          <button class="btn btnPrimary" onclick="compareArtists()" style="height:48px">
            üîç Comparar
          </button>
        </div>
        <button class="btn" onclick="toggleComparativo()" style="background:rgba(255,255,255,0.1)">
          ‚úï Fechar
        </button>
      </div>
    </div>

    <div id="comparativoContent"></div>
  </div>

  <!-- Solicita√ß√µes de Shows -->
  <div class="solicitacoes-section" id="solicitacoesSection" style="display:none">
    <div class="solicitacoes-header">
      <div>
        <h2 class="solicitacoes-title">üìã Solicita√ß√µes de Shows</h2>
        <p class="solicitacoes-subtitle">Pedidos aguardando aprova√ß√£o</p>
      </div>
      <div style="display:flex; gap:15px; flex-wrap:wrap">
        <button class="btn btnPrimary" onclick="gerarLinkSolicitacao()">
          üîó Gerar Link para Contratante
        </button>
        <button class="btn" onclick="toggleSolicitacoes()" style="background:rgba(255,255,255,0.1)">
          ‚úï Fechar
        </button>
      </div>
    </div>

    <div id="solicitacoesContent">
      <div class="empty-state">
        <div style="font-size:80px; opacity:0.3; margin-bottom:20px">üì≠</div>
        <div style="font-size:20px; font-weight:700; color:var(--text-muted); margin-bottom:10px">
          Nenhuma solicita√ß√£o pendente
        </div>
        <div style="font-size:14px; color:var(--text-dim); font-weight:600">
          Clique em "Gerar Link" para criar um formul√°rio para contratantes
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard Analytics -->
  <div class="dashboard-section" id="dashboardSection" style="display:none">
    <div class="dashboard-header">
      <div>
        <h2 class="dashboard-title">üìä Dashboard Analytics</h2>
        <p class="dashboard-subtitle">An√°lise Geogr√°fica e Estat√≠sticas Avan√ßadas</p>
      </div>
      <button class="btn" onclick="toggleDashboard()" style="background:rgba(255,255,255,0.1)">
        ‚úï Fechar
      </button>
    </div>

    <!-- Estat√≠sticas R√°pidas -->
    <div class="quick-stats">
      <div class="quick-stat-card">
        <div class="quick-stat-icon">üé§</div>
        <div class="quick-stat-value" id="totalEventsCount">0</div>
        <div class="quick-stat-label">Total de Shows</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">üèôÔ∏è</div>
        <div class="quick-stat-value" id="totalCitiesCount">0</div>
        <div class="quick-stat-label">Cidades Visitadas</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">üìç</div>
        <div class="quick-stat-value" id="totalStatesCount">0</div>
        <div class="quick-stat-label">Estados Visitados</div>
      </div>
      <div class="quick-stat-card">
        <div class="quick-stat-icon">üí∞</div>
        <div class="quick-stat-value" id="totalRevenueCount">R$ 0</div>
        <div class="quick-stat-label">Faturamento Total</div>
      </div>
    </div>

    <!-- Tabs de Visualiza√ß√£o -->
    <div class="dashboard-tabs">
      <div class="dashboard-tab active" onclick="switchDashboardTab('nacional', this)">
        üáßüá∑ Nacional
      </div>
      <div class="dashboard-tab" onclick="switchDashboardTab('regional', this)">
        üó∫Ô∏è Regional
      </div>
      <div class="dashboard-tab" onclick="switchDashboardTab('cidades', this)">
        üèôÔ∏è Cidades
      </div>
    </div>

    <!-- Conte√∫do do Dashboard -->
    <div id="dashboardContent">
      <!-- Ser√° preenchido dinamicamente -->
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-header-content">
        <div class="modal-title-section">
          <div class="modal-title" id="modalTitle">Novo Evento</div>
          <div class="modal-subtitle" id="modalSubtitle">‚Äî</div>
        </div>
        <div class="close-btn" id="closeModal">‚úï</div>
      </div>
    </div>

    <div class="modal-body">
      <!-- Main Info -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üìç</div>
          <div class="section-label">Informa√ß√µes Principais</div>
        </div>
        
        <div class="form-row cols-5">
          <div class="field field-highlight">
            <label>üìÖ Data</label>
            <input class="input" id="fDate" type="date" />
          </div>
          <div class="field field-highlight">
            <label>‚è∞ Hora In√≠cio</label>
            <input class="input" id="fTimeStart" type="time" />
          </div>
          <div class="field field-highlight">
            <label>‚è±Ô∏è Hora Fim</label>
            <input class="input" id="fTimeEnd" type="time" />
          </div>
          <div class="field field-highlight">
            <label>üèôÔ∏è Cidade</label>
            <input class="input" id="fCity" placeholder="Rio de Janeiro" />
          </div>
          <div class="field field-highlight">
            <label>üìå Estado</label>
            <input class="input" id="fState" placeholder="RJ" maxlength="2" style="text-transform:uppercase" />
          </div>
        </div>

        <div class="field field-highlight">
          <label>üìç Local do Evento</label>
          <input class="input" id="fVenue" placeholder="Nome do local" />
        </div>
      </div>

      <!-- Event Details -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üé§</div>
          <div class="section-label">Detalhes do Evento</div>
        </div>
        
        <div class="field field-highlight">
          <label>üéØ Nome do Evento</label>
          <input class="input" id="fTitle" placeholder="Ex: Show ‚Ä¢ Camarote" />
        </div>

        <div class="form-row cols-4">
          <div class="field">
            <label>Tipo</label>
            <select class="input" id="fEventType">
              <option value="">Selecione</option>
              <option value="show_cenario">Show c/ Cen√°rio</option>
              <option value="show">Show</option>
              <option value="participacao">Participa√ß√£o</option>
            </select>
          </div>
          <div class="field">
            <label>Ingresso</label>
            <select class="input" id="fTicketType">
              <option value="">Selecione</option>
              <option value="bilheteria">Bilheteria</option>
              <option value="cache">Cach√™</option>
            </select>
          </div>
          <div class="field field-highlight">
            <label>üé§ Artista</label>
            <select class="input" id="fArtist">
              <option value="AX">Artista X</option>
              <option value="AY">Artista Y</option>
              <option value="AZ">Artista Z</option>
            </select>
          </div>
          <div class="field field-highlight">
            <label>üéØ Status</label>
            <select class="input" id="fStatus">
              <option value="CONFIRMADO">Confirmado</option>
              <option value="RESERVADO">Reservado</option>
              <option value="NEGOCIANDO">Negociando</option>
              <option value="LEMBRETE">Lembrete</option>
              <option value="OUTROS">Outros</option>
            </select>
          </div>
        </div>

        <div class="form-row cols-2">
          <div class="field">
            <label>‚è±Ô∏è Dura√ß√£o</label>
            <input class="input" id="fDuration" placeholder="00:30h" />
          </div>
          <div class="field field-highlight">
            <label>üí∞ Cach√™</label>
            <input class="input" id="fCache" placeholder="15K" />
          </div>
        </div>
      </div>

      <!-- Contacts -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üë•</div>
          <div class="section-label">Contatos</div>
        </div>
        
        <div class="form-row cols-4">
          <div class="field">
            <label>Empresa</label>
            <input class="input" id="fCompany" />
          </div>
          <div class="field field-highlight">
            <label>üë§ Contratante</label>
            <input class="input" id="fClient" />
          </div>
          <div class="field">
            <label>Contato</label>
            <input class="input" id="fContact" />
          </div>
          <div class="field field-highlight">
            <label>üìû Telefone</label>
            <input class="input" id="fPhone" placeholder="(00) 00000-0000" />
          </div>
        </div>

        <div class="form-row cols-2">
          <div class="field">
            <label>üìß E-mail</label>
            <input class="input" id="fEmail" type="email" />
          </div>
          <div class="field">
            <label>Despesas</label>
            <input class="input" id="fExpenses" />
          </div>
        </div>
      </div>

      <!-- Additional -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-icon">üìã</div>
          <div class="section-label">Informa√ß√µes Adicionais</div>
        </div>
        
        <div class="field">
          <label>Observa√ß√µes</label>
          <textarea class="textarea" id="fNotes" placeholder="Notas e observa√ß√µes..."></textarea>
        </div>

        <div class="toggle-field">
          <div class="toggle-label">‚úÖ Contrato Enviado</div>
          <div class="toggle" id="fContract"></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button class="btnDanger" id="btnDelete">üóëÔ∏è Deletar</button>
        <button class="btnSecondary" id="btnDuplicate">üìã Duplicar</button>
        <button class="btnSave" id="btnSave">üíæ Salvar Evento</button>
      </div>
    </div>
  </div>
</div>

<script>
  const ARTISTS = [
    { id:"AX", name:"Artista X", color:"#FF0080" },
    { id:"AY", name:"Artista Y", color:"#00F0FF" },
    { id:"AZ", name:"Artista Z", color:"#FFB800" }
  ];

  const STATUSES = [
    { id:"CONFIRMADO", label:"Confirmado", color:"#10b981" },
    { id:"RESERVADO", label:"Reservado", color:"#6366f1" },
    { id:"NEGOCIANDO", label:"Negociando", color:"#f59e0b" },
    { id:"LEMBRETE", label:"Lembrete", color:"#06b6d4" },
    { id:"OUTROS", label:"Outros", color:"#64748b" }
  ];

  // ==================== SISTEMA DE PERMISS√ïES ====================
  
  let currentUser = null;
  let permissions = null;

  function checkAuthentication(){
    const session = localStorage.getItem('userSession');
    
    if(!session){
      // N√£o est√° logado, redirecionar para login
      window.location.href = 'agenda-login.html';
      return false;
    }

    try {
      const parsed = JSON.parse(session);
      currentUser = parsed.user;
      permissions = parsed.permissions;

      // Mostrar informa√ß√µes do usu√°rio
      showUserInfo();
      
      // Aplicar permiss√µes na interface
      applyPermissions();

      return true;
    } catch(e){
      // Sess√£o inv√°lida
      localStorage.removeItem('userSession');
      window.location.href = 'agenda-login.html';
      return false;
    }
  }

  function showUserInfo(){
    // Adicionar badge com nome do usu√°rio
    const headerActions = document.querySelector('.header-actions');
    
    const userBadge = document.createElement('div');
    userBadge.style.cssText = `
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 20px;
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:999px;
      font-size:13px;
      font-weight:700;
      color:var(--text-secondary);
    `;

    const roleColors = {
      admin: '#FF0080',
      producer: '#00F0FF',
      team: '#10b981'
    };

    const roleIcons = {
      admin: 'üëë',
      producer: 'üìä',
      team: 'üë•'
    };

    const roleNames = {
      admin: 'ADMIN',
      producer: 'PRODUTOR',
      team: 'EQUIPE'
    };

    userBadge.innerHTML = `
      <span style="font-size:18px">${roleIcons[currentUser.role]}</span>
      <span>${currentUser.name}</span>
      <span style="color:${roleColors[currentUser.role]}; font-weight:900">${roleNames[currentUser.role]}</span>
    `;

    headerActions.appendChild(userBadge);

    // Adicionar bot√£o de logout
    const logoutBtn = document.createElement('button');
    logoutBtn.className = 'btn';
    logoutBtn.innerHTML = 'üö™ Sair';
    logoutBtn.style.cssText = 'background:rgba(239,68,68,0.15); border-color:rgba(239,68,68,0.3); color:var(--danger)';
    logoutBtn.onclick = logout;
    headerActions.appendChild(logoutBtn);
  }

  function logout(){
    if(confirm('üö™ Deseja realmente sair?')){
      localStorage.removeItem('userSession');
      window.location.href = 'agenda-login.html';
    }
  }

  function applyPermissions(){
    // Esconder/desabilitar funcionalidades baseado nas permiss√µes

    // Bot√£o "+ Novo"
    if(!permissions.createEvents){
      const btnNew = document.getElementById('btnNew');
      if(btnNew){
        btnNew.style.display = 'none';
      }
    }

    // Bot√£o Comparativo
    if(!permissions.viewComparativo){
      const btnComparativo = document.getElementById('btnComparativo');
      if(btnComparativo){
        btnComparativo.style.display = 'none';
      }
    }

    // Bot√£o Dashboard
    if(!permissions.viewDashboard){
      const btnDashboard = document.getElementById('btnDashboard');
      if(btnDashboard){
        btnDashboard.style.display = 'none';
      }
    }

    // Bot√£o Solicita√ß√µes
    if(!permissions.manageSolicitacoes){
      const btnSolicitacoes = document.getElementById('btnSolicitacoes');
      if(btnSolicitacoes){
        btnSolicitacoes.style.display = 'none';
      }
    }

    // Filtros (manter vis√≠veis mas desabilitar edi√ß√£o se necess√°rio)
    // Para equipe, esconder filtros de status
    if(currentUser.role === 'team'){
      const statusChipsContainer = document.getElementById('statusChips');
      if(statusChipsContainer){
        statusChipsContainer.style.display = 'none';
      }
    }

    console.log('üîê Permiss√µes aplicadas:', permissions);
  }

  function canEdit(){
    return permissions && permissions.editEvents;
  }

  function canDelete(){
    return permissions && permissions.deleteEvents;
  }

  function canViewFinancial(){
    return permissions && permissions.viewFinancial;
  }

  function canViewContacts(){
    return permissions && permissions.viewContacts;
  }

  // Verificar autentica√ß√£o antes de carregar
  if(!checkAuthentication()){
    // Para execu√ß√£o se n√£o autenticado
    throw new Error('N√£o autenticado');
  }

  let events = JSON.parse(localStorage.getItem('agendaEvents')) || [];
  
  const state = {
    viewDate: new Date(),
    statusFilter: new Set(),
    artistFilter: "ALL",
    query: "",
    selectedId: null
  };

  // Initialize
  function init(){
    // Populate artist filter
    const artistSelect = document.getElementById('artistFilter');
    artistSelect.innerHTML = `<option value="ALL">Todos Artistas</option>` +
      ARTISTS.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
    artistSelect.addEventListener('change', ()=> {
      state.artistFilter = artistSelect.value;
      render();
    });

    // Create status chips
    const statusChips = document.getElementById('statusChips');
    statusChips.innerHTML = STATUSES.map(s => `
      <div class="chip" data-status="${s.id}">
        <span class="dot" style="background:${s.color}"></span>
        <span>${s.label}</span>
      </div>
    `).join('');

    statusChips.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', ()=> {
        const status = chip.getAttribute('data-status');
        if(state.statusFilter.has(status)){
          state.statusFilter.delete(status);
          chip.classList.remove('active');
        } else {
          state.statusFilter.add(status);
          chip.classList.add('active');
        }
        render();
      });
    });

    // Event listeners
    document.getElementById('prevMonth').addEventListener('click', ()=> shiftMonth(-1));
    document.getElementById('nextMonth').addEventListener('click', ()=> shiftMonth(1));
    document.getElementById('btnToday').addEventListener('click', goToday);
    document.getElementById('btnNew').addEventListener('click', ()=> openModal());
    document.getElementById('closeModal').addEventListener('click', closeModal);
    document.getElementById('modalOverlay').addEventListener('click', (e)=> {
      if(e.target.id === 'modalOverlay') closeModal();
    });

    document.getElementById('searchInput').addEventListener('input', (e)=> {
      state.query = e.target.value.toLowerCase();
      render();
    });

    document.getElementById('fContract').addEventListener('click', function(){
      this.classList.toggle('on');
    });

    document.getElementById('btnSave').addEventListener('click', saveEvent);
    document.getElementById('btnDelete').addEventListener('click', deleteEvent);
    document.getElementById('btnDuplicate').addEventListener('click', duplicateEvent);

    // ESC to close modal
    document.addEventListener('keydown', (e)=> {
      if(e.key === 'Escape' && document.getElementById('modalOverlay').classList.contains('show')){
        closeModal();
      }
    });

    render();
  }

  function render(){
    const y = state.viewDate.getFullYear();
    const m = state.viewDate.getMonth();

    // Update month label
    const monthName = state.viewDate.toLocaleString('pt-BR', {month:'long', year:'numeric'});
    document.getElementById('monthLabel').textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

    // Filter events
    const filtered = events.filter(matchesFilters);
    const monthEvents = filtered.filter(e => {
      const d = new Date(e.date);
      return d.getFullYear() === y && d.getMonth() === m;
    });

    document.getElementById('countLabel').textContent = `${monthEvents.length} eventos`;

    // Generate calendar
    const firstDay = new Date(y, m, 1);
    let startDow = firstDay.getDay();
    startDow = startDow === 0 ? 6 : startDow - 1;
    const cells = [];

    for(let i = 0; i < 42; i++){
      const dayIndex = i - startDow + 1;
      const date = new Date(y, m, dayIndex);
      const inMonth = date.getMonth() === m;
      const dateStr = formatDate(date);
      const isToday = isSameDay(date, new Date());
      const dayEvents = filtered.filter(e => e.date === dateStr);

      cells.push({date, dateStr, inMonth, isToday, dayEvents});
    }

    // Render days
    const grid = document.getElementById('daysGrid');
    grid.innerHTML = cells.map(cell => {
      const classes = ['day'];
      if(!cell.inMonth) classes.push('other-month');
      if(cell.isToday) classes.push('today');
      
      const dayOfWeek = cell.date.getDay();
      if(dayOfWeek === 0 || dayOfWeek === 6) classes.push('weekend');

      const todayTag = cell.isToday ? '<span class="today-tag">Hoje</span>' : '';
      const eventsHtml = cell.dayEvents.map(e => renderEvent(e)).join('');

      return `
        <div class="${classes.join(' ')}" data-date="${cell.dateStr}">
          <div class="day-header">
            <div class="day-number">${cell.date.getDate()}</div>
            ${todayTag}
          </div>
          ${eventsHtml}
        </div>
      `;
    }).join('');

    // Add click handlers
    grid.querySelectorAll('.event').forEach(el => {
      el.addEventListener('click', (e)=> {
        e.stopPropagation();
        const id = el.getAttribute('data-id');
        openModal(id);
      });
    });

    grid.querySelectorAll('.day').forEach(el => {
      el.addEventListener('click', (e)=> {
        // Don't open if clicking on the + button
        if(e.target.closest('.day::after')) return;
        
        const date = el.getAttribute('data-date');
        openModal(null, date);
      });
      
      // Handle + button click separately
      el.addEventListener('click', (e)=> {
        const rect = el.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        // Check if click is in top-right corner (where + button appears)
        if(x > rect.width - 50 && y < 50){
          e.stopPropagation();
          const date = el.getAttribute('data-date');
          openModal(null, date);
        }
      });
    });
  }

  function renderEvent(event){
    const status = STATUSES.find(s => s.id === event.status) || STATUSES[0];
    const time = event.timeStart || '';
    
    // Para equipe, mostrar apenas local sem detalhes sens√≠veis
    let location = '';
    if(currentUser.role === 'team'){
      // Equipe v√™ apenas cidade
      location = event.city || '';
    } else {
      // Admin e Produtor veem local completo
      location = [event.venue, event.city].filter(x=>x).join(' ‚Ä¢ ');
    }

    return `
      <div class="event" style="background:${status.color}" data-id="${event.id}">
        <div class="event-title">${escapeHtml(event.title || 'Evento')}</div>
        <div class="event-meta">
          ${time ? `<span>‚è± ${time}</span>` : ''}
          ${location ? `<span>üìç ${escapeHtml(location)}</span>` : ''}
        </div>
      </div>
    `;
  }

  function openModal(id = null, date = null){
    // Verificar se pode editar
    if(id && !canEdit()){
      // Modo visualiza√ß√£o apenas
      viewEventDetails(id);
      return;
    }

    if(!id && !permissions.createEvents){
      alert('‚ö†Ô∏è Voc√™ n√£o tem permiss√£o para criar eventos.');
      return;
    }

    const modal = document.getElementById('modalOverlay');
    
    if(id){
      // Edit mode
      const event = events.find(e => e.id === id);
      if(!event) return;

      state.selectedId = id;
      document.getElementById('modalTitle').textContent = 'üé§ Editar Evento';
      
      const artist = ARTISTS.find(a => a.id === event.artist);
      const status = STATUSES.find(s => s.id === event.status);
      document.getElementById('modalSubtitle').textContent = `${artist?.name || ''} ‚Ä¢ ${status?.label || ''}`;

      // Fill form
      document.getElementById('fDate').value = event.date || '';
      document.getElementById('fTimeStart').value = event.timeStart || '';
      document.getElementById('fTimeEnd').value = event.timeEnd || '';
      document.getElementById('fCity').value = event.city || '';
      document.getElementById('fState').value = event.state || '';
      document.getElementById('fVenue').value = event.venue || '';
      document.getElementById('fTitle').value = event.title || '';
      document.getElementById('fEventType').value = event.eventType || '';
      document.getElementById('fTicketType').value = event.ticketType || '';
      document.getElementById('fArtist').value = event.artist || ARTISTS[0].id;
      document.getElementById('fStatus').value = event.status || 'RESERVADO';
      document.getElementById('fDuration').value = event.duration || '';
      document.getElementById('fCache').value = event.cache || '';
      document.getElementById('fCompany').value = event.company || '';
      document.getElementById('fClient').value = event.client || '';
      document.getElementById('fContact').value = event.contact || '';
      document.getElementById('fPhone').value = event.phone || '';
      document.getElementById('fEmail').value = event.email || '';
      document.getElementById('fExpenses').value = event.expenses || '';
      document.getElementById('fNotes').value = event.notes || '';
      document.getElementById('fContract').classList.toggle('on', event.contractSent || false);
    } else {
      // New event mode
      state.selectedId = null;
      document.getElementById('modalTitle').textContent = 'üé§ Novo Evento';
      document.getElementById('modalSubtitle').textContent = 'Preencha as informa√ß√µes abaixo';

      // Clear form
      document.getElementById('fDate').value = date || formatDate(new Date());
      document.getElementById('fTimeStart').value = '20:00';
      document.getElementById('fTimeEnd').value = '22:00';
      document.getElementById('fCity').value = '';
      document.getElementById('fState').value = '';
      document.getElementById('fVenue').value = '';
      document.getElementById('fTitle').value = '';
      document.getElementById('fEventType').value = '';
      document.getElementById('fTicketType').value = '';
      document.getElementById('fArtist').value = state.artistFilter !== 'ALL' ? state.artistFilter : ARTISTS[0].id;
      document.getElementById('fStatus').value = 'RESERVADO';
      document.getElementById('fDuration').value = '';
      document.getElementById('fCache').value = '';
      document.getElementById('fCompany').value = '';
      document.getElementById('fClient').value = '';
      document.getElementById('fContact').value = '';
      document.getElementById('fPhone').value = '';
      document.getElementById('fEmail').value = '';
      document.getElementById('fExpenses').value = '';
      document.getElementById('fNotes').value = '';
      document.getElementById('fContract').classList.remove('on');
    }

    // Ocultar campos financeiros se n√£o tiver permiss√£o
    if(!canViewFinancial()){
      const cacheField = document.getElementById('fCache').closest('.field');
      const expensesField = document.getElementById('fExpenses').closest('.field');
      if(cacheField) cacheField.style.display = 'none';
      if(expensesField) expensesField.style.display = 'none';
    } else {
      const cacheField = document.getElementById('fCache').closest('.field');
      const expensesField = document.getElementById('fExpenses').closest('.field');
      if(cacheField) cacheField.style.display = 'flex';
      if(expensesField) expensesField.style.display = 'flex';
    }

    // Ocultar campos de contato se n√£o tiver permiss√£o
    if(!canViewContacts()){
      const contactsSection = document.querySelector('.form-section:nth-child(3)'); // Se√ß√£o de contatos
      if(contactsSection) contactsSection.style.display = 'none';
    } else {
      const contactsSection = document.querySelector('.form-section:nth-child(3)');
      if(contactsSection) contactsSection.style.display = 'block';
    }

    // Desabilitar bot√µes de a√ß√£o se n√£o tiver permiss√£o
    const btnSave = document.getElementById('btnSave');
    const btnDelete = document.getElementById('btnDelete');
    const btnDuplicate = document.getElementById('btnDuplicate');

    if(!canEdit() && id){
      btnSave.style.display = 'none';
    } else {
      btnSave.style.display = 'inline-flex';
    }

    if(!canDelete()){
      btnDelete.style.display = 'none';
    } else {
      btnDelete.style.display = 'inline-flex';
    }

    if(!permissions.createEvents){
      btnDuplicate.style.display = 'none';
    } else {
      btnDuplicate.style.display = 'inline-flex';
    }

    modal.classList.add('show');
  }

  function viewEventDetails(id){
    // Modo visualiza√ß√£o apenas para usu√°rios sem permiss√£o de edi√ß√£o
    const event = events.find(e => e.id === id);
    if(!event) return;

    const modal = document.getElementById('modalOverlay');
    const modalBody = modal.querySelector('.modal-body');

    const artist = ARTISTS.find(a => a.id === event.artist);
    const status = STATUSES.find(s => s.id === event.status);

    document.getElementById('modalTitle').textContent = 'üëÅÔ∏è Visualizar Evento';
    document.getElementById('modalSubtitle').textContent = `${artist?.name || ''} ‚Ä¢ ${status?.label || ''} ‚Ä¢ Somente Leitura`;

    // Criar visualiza√ß√£o em cards
    let html = `
      <div style="padding:20px">
        <!-- Informa√ß√µes Principais -->
        <div class="form-section" style="margin-bottom:25px">
          <div class="section-header">
            <div class="section-icon">üìç</div>
            <div class="section-label">Informa√ß√µes Principais</div>
          </div>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px">
            ${event.date ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üìÖ DATA</div><div style="font-size:16px; font-weight:900">${new Date(event.date).toLocaleDateString('pt-BR')}</div></div>` : ''}
            ${event.timeStart ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">‚è∞ HORA</div><div style="font-size:16px; font-weight:900">${event.timeStart}</div></div>` : ''}
            ${event.city ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üèôÔ∏è CIDADE</div><div style="font-size:16px; font-weight:900">${event.city}</div></div>` : ''}
            ${event.state ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üìå ESTADO</div><div style="font-size:16px; font-weight:900">${event.state}</div></div>` : ''}
          </div>
          ${event.venue ? `<div style="margin-top:15px"><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üìç LOCAL</div><div style="font-size:16px; font-weight:900">${event.venue}</div></div>` : ''}
        </div>

        <!-- Detalhes do Evento -->
        <div class="form-section" style="margin-bottom:25px">
          <div class="section-header">
            <div class="section-icon">üé§</div>
            <div class="section-label">Detalhes do Evento</div>
          </div>
          ${event.title ? `<div style="margin-bottom:15px"><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üéØ NOME DO EVENTO</div><div style="font-size:18px; font-weight:900; color:var(--primary)">${event.title}</div></div>` : ''}
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px">
            ${event.duration ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">‚è±Ô∏è DURA√á√ÉO</div><div style="font-size:16px; font-weight:900">${event.duration}</div></div>` : ''}
            ${canViewFinancial() && event.cache ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üí∞ CACH√ä</div><div style="font-size:16px; font-weight:900; color:var(--success)">${event.cache}</div></div>` : ''}
          </div>
        </div>

        ${canViewContacts() ? `
        <!-- Contatos -->
        <div class="form-section" style="margin-bottom:25px">
          <div class="section-header">
            <div class="section-icon">üë•</div>
            <div class="section-label">Contatos</div>
          </div>
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:15px">
            ${event.client ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üë§ CONTRATANTE</div><div style="font-size:16px; font-weight:900">${event.client}</div></div>` : ''}
            ${event.phone ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üìû TELEFONE</div><div style="font-size:16px; font-weight:900">${event.phone}</div></div>` : ''}
            ${event.email ? `<div><div style="font-size:11px; color:var(--text-muted); font-weight:700; margin-bottom:5px">üìß E-MAIL</div><div style="font-size:16px; font-weight:900">${event.email}</div></div>` : ''}
          </div>
        </div>
        ` : ''}

        ${event.notes ? `
        <!-- Observa√ß√µes -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon">üìã</div>
            <div class="section-label">Observa√ß√µes</div>
          </div>
          <div style="padding:15px; background:rgba(255,255,255,0.05); border-radius:12px; line-height:1.6">${event.notes}</div>
        </div>
        ` : ''}

        <div style="margin-top:30px; display:flex; justify-content:center">
          <button class="btn btnSecondary" onclick="closeModal()" style="padding:0 40px">
            Fechar
          </button>
        </div>
      </div>
    `;

    modalBody.innerHTML = html;
    modal.classList.add('show');
  }

  function closeModal(){
    const modal = document.getElementById('modalOverlay');
    modal.classList.remove('show');
    state.selectedId = null;

    // Restaurar o formul√°rio original se foi alterado
    setTimeout(() => {
      const modalBody = modal.querySelector('.modal-body');
      if(modalBody && modalBody.querySelector('form') === null){
        // Foi alterado para visualiza√ß√£o, restaurar formul√°rio
        location.reload(); // Recarregar para restaurar formul√°rio (solu√ß√£o simples)
      }
    }, 300);
  }

  function saveEvent(){
    const data = {
      date: document.getElementById('fDate').value,
      timeStart: document.getElementById('fTimeStart').value,
      timeEnd: document.getElementById('fTimeEnd').value,
      city: document.getElementById('fCity').value,
      state: document.getElementById('fState').value,
      venue: document.getElementById('fVenue').value,
      title: document.getElementById('fTitle').value,
      eventType: document.getElementById('fEventType').value,
      ticketType: document.getElementById('fTicketType').value,
      artist: document.getElementById('fArtist').value,
      status: document.getElementById('fStatus').value,
      duration: document.getElementById('fDuration').value,
      cache: document.getElementById('fCache').value,
      company: document.getElementById('fCompany').value,
      client: document.getElementById('fClient').value,
      contact: document.getElementById('fContact').value,
      phone: document.getElementById('fPhone').value,
      email: document.getElementById('fEmail').value,
      expenses: document.getElementById('fExpenses').value,
      notes: document.getElementById('fNotes').value,
      contractSent: document.getElementById('fContract').classList.contains('on')
    };

    if(state.selectedId){
      // Update
      const idx = events.findIndex(e => e.id === state.selectedId);
      if(idx >= 0) events[idx] = {...events[idx], ...data};
    } else {
      // Create
      events.push({id: generateId(), ...data});
    }

    localStorage.setItem('agendaEvents', JSON.stringify(events));
    closeModal();
    render();
  }

  function deleteEvent(){
    if(!state.selectedId) return;
    if(!confirm('Deletar este evento?')) return;

    events = events.filter(e => e.id !== state.selectedId);
    localStorage.setItem('agendaEvents', JSON.stringify(events));
    closeModal();
    render();
  }

  function duplicateEvent(){
    if(!state.selectedId) return;

    const event = events.find(e => e.id === state.selectedId);
    if(!event) return;

    const newEvent = {...event, id: generateId(), title: event.title + ' (C√≥pia)'};
    events.push(newEvent);
    localStorage.setItem('agendaEvents', JSON.stringify(events));
    closeModal();
    render();
  }

  function shiftMonth(delta){
    const d = state.viewDate;
    state.viewDate = new Date(d.getFullYear(), d.getMonth() + delta, 1);
    render();
  }

  function goToday(){
    state.viewDate = new Date();
    render();
  }

  function matchesFilters(event){
    if(state.artistFilter !== 'ALL' && event.artist !== state.artistFilter) return false;
    if(state.statusFilter.size > 0 && !state.statusFilter.has(event.status)) return false;
    if(state.query){
      const text = [
        event.title, event.city, event.venue, event.client, event.notes
      ].join(' ').toLowerCase();
      if(!text.includes(state.query)) return false;
    }
    return true;
  }

  function formatDate(date){
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  function isSameDay(a, b){
    return a.getFullYear() === b.getFullYear() &&
           a.getMonth() === b.getMonth() &&
           a.getDate() === b.getDate();
  }

  function escapeHtml(str){
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
  }

  function generateId(){
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
  }

  init();
  console.log('üé® Agenda com modal redesenhado carregada!');

  // Fun√ß√£o de Comparativo de Artistas
  function compareArtists(){
    const artistAId = document.getElementById('artistA').value;
    const artistBId = document.getElementById('artistB').value;

    if(artistAId === artistBId){
      alert('‚ö†Ô∏è Selecione artistas diferentes para comparar!');
      return;
    }

    const artistA = ARTISTS.find(a => a.id === artistAId);
    const artistB = ARTISTS.find(a => a.id === artistBId);

    // Filtrar eventos de cada artista
    const eventsA = events.filter(e => e.artist === artistAId);
    const eventsB = events.filter(e => e.artist === artistBId);

    // Calcular estat√≠sticas
    const statsA = calculateArtistStats(eventsA);
    const statsB = calculateArtistStats(eventsB);

    // Determinar vencedor
    const winnerByShows = statsA.totalShows > statsB.totalShows ? 'A' : statsB.totalShows > statsA.totalShows ? 'B' : 'tie';
    const winnerByRevenue = statsA.totalRevenue > statsB.totalRevenue ? 'A' : statsB.totalRevenue > statsA.totalRevenue ? 'B' : 'tie';

    // Renderizar comparativo
    renderComparison(artistA, artistB, statsA, statsB, winnerByShows, winnerByRevenue);
  }

  function calculateArtistStats(artistEvents){
    const totalShows = artistEvents.length;
    
    // Calcular faturamento total
    let totalRevenue = 0;
    artistEvents.forEach(event => {
      if(event.cache){
        // Remove "K", "k" e converte para n√∫mero
        const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
        const numeric = parseFloat(value);
        if(!isNaN(numeric)){
          // Se tinha K, multiplica por 1000
          totalRevenue += event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
        }
      }
    });

    // Shows por status
    const confirmedShows = artistEvents.filter(e => e.status === 'CONFIRMADO').length;
    const reservedShows = artistEvents.filter(e => e.status === 'RESERVADO').length;
    const negotiatingShows = artistEvents.filter(e => e.status === 'NEGOCIANDO').length;

    // M√©dia de cach√™
    const avgRevenue = totalShows > 0 ? totalRevenue / totalShows : 0;

    // Maior cach√™
    let maxRevenue = 0;
    let maxRevenueEvent = null;
    artistEvents.forEach(event => {
      if(event.cache){
        const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
        const numeric = parseFloat(value);
        if(!isNaN(numeric)){
          const revenue = event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
          if(revenue > maxRevenue){
            maxRevenue = revenue;
            maxRevenueEvent = event;
          }
        }
      }
    });

    return {
      totalShows,
      totalRevenue,
      confirmedShows,
      reservedShows,
      negotiatingShows,
      avgRevenue,
      maxRevenue,
      maxRevenueEvent
    };
  }

  function renderComparison(artistA, artistB, statsA, statsB, winnerByShows, winnerByRevenue){
    const content = document.getElementById('comparativoContent');

    const diffShows = statsA.totalShows - statsB.totalShows;
    const diffRevenue = statsA.totalRevenue - statsB.totalRevenue;
    const diffPercent = statsB.totalRevenue > 0 ? ((diffRevenue / statsB.totalRevenue) * 100) : 0;

    content.innerHTML = `
      <div class="comparison-grid">
        <!-- Artista A -->
        <div class="artist-column ${winnerByRevenue === 'A' ? 'winner' : ''}">
          <div class="artist-name">
            üé§ ${artistA.name}
            ${winnerByRevenue === 'A' ? '<span class="winner-badge">üèÜ VENCEDOR</span>' : ''}
          </div>
          
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">üìä Total Shows</span>
              <span class="stat-value">${statsA.totalShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üí∞ Faturamento Total</span>
              <span class="stat-value highlight">R$ ${formatMoney(statsA.totalRevenue)}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">‚úÖ Confirmados</span>
              <span class="stat-value">${statsA.confirmedShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üìÖ Reservados</span>
              <span class="stat-value">${statsA.reservedShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">ü§ù Negociando</span>
              <span class="stat-value">${statsA.negotiatingShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üìà Cach√™ M√©dio</span>
              <span class="stat-value">R$ ${formatMoney(statsA.avgRevenue)}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üî• Maior Cach√™</span>
              <span class="stat-value">R$ ${formatMoney(statsA.maxRevenue)}</span>
            </div>
          </div>
        </div>

        <!-- VS Divider -->
        <div class="vs-divider">
          <div class="vs-circle">VS</div>
        </div>

        <!-- Artista B -->
        <div class="artist-column ${winnerByRevenue === 'B' ? 'winner' : ''}">
          <div class="artist-name">
            üé§ ${artistB.name}
            ${winnerByRevenue === 'B' ? '<span class="winner-badge">üèÜ VENCEDOR</span>' : ''}
          </div>
          
          <div class="stats-list">
            <div class="stat-item">
              <span class="stat-label">üìä Total Shows</span>
              <span class="stat-value">${statsB.totalShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üí∞ Faturamento Total</span>
              <span class="stat-value highlight">R$ ${formatMoney(statsB.totalRevenue)}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">‚úÖ Confirmados</span>
              <span class="stat-value">${statsB.confirmedShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üìÖ Reservados</span>
              <span class="stat-value">${statsB.reservedShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">ü§ù Negociando</span>
              <span class="stat-value">${statsB.negotiatingShows}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üìà Cach√™ M√©dio</span>
              <span class="stat-value">R$ ${formatMoney(statsB.avgRevenue)}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">üî• Maior Cach√™</span>
              <span class="stat-value">R$ ${formatMoney(statsB.maxRevenue)}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Diferen√ßas -->
      <div class="difference-cards">
        <div class="difference-card">
          <div class="difference-card-title">üìä Diferen√ßa em Shows</div>
          <div class="difference-value ${diffShows > 0 ? 'positive' : diffShows < 0 ? 'negative' : ''}">
            ${diffShows > 0 ? '+' : ''}${diffShows}
          </div>
          <div class="difference-text">
            ${Math.abs(diffShows)} show${Math.abs(diffShows) !== 1 ? 's' : ''} de diferen√ßa
          </div>
        </div>

        <div class="difference-card">
          <div class="difference-card-title">üí∞ Diferen√ßa em Faturamento</div>
          <div class="difference-value ${diffRevenue > 0 ? 'positive' : diffRevenue < 0 ? 'negative' : ''}">
            ${diffRevenue > 0 ? '+' : ''}R$ ${formatMoney(Math.abs(diffRevenue))}
          </div>
          <div class="difference-text">
            ${Math.abs(diffPercent).toFixed(1)}% de diferen√ßa
          </div>
        </div>

        <div class="difference-card">
          <div class="difference-card-title">üìà Cach√™ M√©dio - Diferen√ßa</div>
          <div class="difference-value ${statsA.avgRevenue > statsB.avgRevenue ? 'positive' : 'negative'}">
            ${statsA.avgRevenue > statsB.avgRevenue ? '+' : ''}R$ ${formatMoney(Math.abs(statsA.avgRevenue - statsB.avgRevenue))}
          </div>
          <div class="difference-text">
            Por show
          </div>
        </div>

        <div class="difference-card">
          <div class="difference-card-title">‚úÖ Taxa de Confirma√ß√£o</div>
          <div class="difference-value">
            ${statsA.totalShows > 0 ? ((statsA.confirmedShows / statsA.totalShows) * 100).toFixed(0) : 0}% vs ${statsB.totalShows > 0 ? ((statsB.confirmedShows / statsB.totalShows) * 100).toFixed(0) : 0}%
          </div>
          <div class="difference-text">
            Shows confirmados
          </div>
        </div>
      </div>

      <!-- Insights -->
      <div class="insights-box">
        <h3>ü§ñ Insights da An√°lise</h3>
        
        ${winnerByRevenue !== 'tie' ? `
        <div class="insight-item">
          <p><strong>${winnerByRevenue === 'A' ? artistA.name : artistB.name}</strong> est√° faturando <strong>R$ ${formatMoney(Math.abs(diffRevenue))}</strong> a mais (${Math.abs(diffPercent).toFixed(1)}% superior).</p>
        </div>
        ` : ''}

        ${diffShows !== 0 ? `
        <div class="insight-item">
          <p><strong>${diffShows > 0 ? artistA.name : artistB.name}</strong> tem <strong>${Math.abs(diffShows)} show${Math.abs(diffShows) > 1 ? 's' : ''}</strong> a mais na agenda.</p>
        </div>
        ` : ''}

        ${statsA.avgRevenue > statsB.avgRevenue ? `
        <div class="insight-item">
          <p><strong>${artistA.name}</strong> tem um cach√™ m√©dio <strong>R$ ${formatMoney(statsA.avgRevenue - statsB.avgRevenue)}</strong> maior por show.</p>
        </div>
        ` : statsB.avgRevenue > statsA.avgRevenue ? `
        <div class="insight-item">
          <p><strong>${artistB.name}</strong> tem um cach√™ m√©dio <strong>R$ ${formatMoney(statsB.avgRevenue - statsA.avgRevenue)}</strong> maior por show.</p>
        </div>
        ` : ''}

        ${statsA.confirmedShows > statsB.confirmedShows ? `
        <div class="insight-item">
          <p><strong>${artistA.name}</strong> tem mais shows confirmados: <strong>${statsA.confirmedShows}</strong> vs <strong>${statsB.confirmedShows}</strong>.</p>
        </div>
        ` : statsB.confirmedShows > statsA.confirmedShows ? `
        <div class="insight-item">
          <p><strong>${artistB.name}</strong> tem mais shows confirmados: <strong>${statsB.confirmedShows}</strong> vs <strong>${statsA.confirmedShows}</strong>.</p>
        </div>
        ` : ''}

        <div class="insight-item">
          <p>üí° <strong>Recomenda√ß√£o:</strong> ${diffRevenue > 0 ? 
            `Focar em converter os shows reservados de ${artistB.name} para aumentar o faturamento.` : 
            `Buscar mais oportunidades de shows de alta valoriza√ß√£o para ${artistA.name}.`}
          </p>
        </div>
      </div>
    `;
  }

  function formatMoney(value){
    if(value >= 1000000){
      return (value / 1000000).toFixed(2).replace('.', ',') + 'M';
    }
    if(value >= 1000){
      return (value / 1000).toFixed(1).replace('.', ',') + 'K';
    }
    return value.toFixed(2).replace('.', ',');
  }

  // Auto-comparar ao carregar (se houver eventos)
  if(events.length > 0){
    setTimeout(() => compareArtists(), 1000);
  }

  // ==================== TOGGLE COMPARATIVO ====================

  function toggleComparativo(){
    const comparativo = document.getElementById('comparativoSection');
    const isVisible = comparativo.style.display !== 'none';
    
    if(isVisible){
      comparativo.style.display = 'none';
      document.getElementById('btnComparativo').innerHTML = '‚öîÔ∏è Comparativo';
    } else {
      comparativo.style.display = 'block';
      document.getElementById('btnComparativo').innerHTML = '‚úï Fechar Comparativo';
      compareArtists(); // Auto-carregar compara√ß√£o
      // Scroll to comparativo
      setTimeout(() => {
        comparativo.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }
  }

  // ==================== SISTEMA DE SOLICITA√á√ïES ====================

  let solicitacoes = JSON.parse(localStorage.getItem('solicitacoes')) || [];

  function openSolicitacoesPanel(){
    const panel = document.getElementById('solicitacoesSection');
    panel.style.display = 'block';
    renderSolicitacoes();
    
    setTimeout(() => {
      panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }

  function toggleSolicitacoes(){
    const panel = document.getElementById('solicitacoesSection');
    panel.style.display = 'none';
  }

  function renderSolicitacoes(){
    updateSolicitacoesBadge();
    
    const content = document.getElementById('solicitacoesContent');
    const pendentes = solicitacoes.filter(s => s.status === 'pendente');
    
    if(pendentes.length === 0){
      content.innerHTML = `
        <div class="empty-state">
          <div style="font-size:80px; opacity:0.3; margin-bottom:20px">üì≠</div>
          <div style="font-size:20px; font-weight:700; color:var(--text-muted); margin-bottom:10px">
            Nenhuma solicita√ß√£o pendente
          </div>
          <div style="font-size:14px; color:var(--text-dim); font-weight:600; margin-bottom:30px">
            Clique em "Gerar Link" para criar um formul√°rio para contratantes
          </div>
          <button class="btn btnPrimary" onclick="gerarLinkSolicitacao()" style="height:48px">
            üîó Gerar Novo Link
          </button>
        </div>
      `;
      return;
    }

    content.innerHTML = `
      <div style="margin-bottom:25px">
        <button class="btn btnPrimary" onclick="gerarLinkSolicitacao()" style="height:48px">
          üîó Gerar Novo Link
        </button>
      </div>
      ${pendentes.map(sol => `
        <div class="solicitacao-card">
          <div class="solicitacao-header">
            <div class="solicitacao-info">
              <h3>${sol.eventTitle || 'Show'}</h3>
              <div class="solicitacao-meta">
                üìÖ Solicitado em ${new Date(sol.createdAt).toLocaleDateString('pt-BR')} √†s ${new Date(sol.createdAt).toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})}
              </div>
            </div>
            <div class="solicitacao-status ${sol.status}">
              ${sol.status === 'pendente' ? '‚è≥ Pendente' : sol.status === 'aprovado' ? '‚úÖ Aprovado' : '‚ùå Rejeitado'}
            </div>
          </div>

          <div class="solicitacao-detalhes">
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üìÖ Data</div>
              <div class="solicitacao-detalhe-value">${new Date(sol.date).toLocaleDateString('pt-BR')}</div>
            </div>
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">‚è∞ Hor√°rio</div>
              <div class="solicitacao-detalhe-value">${sol.timeStart || '--:--'}</div>
            </div>
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üèôÔ∏è Cidade</div>
              <div class="solicitacao-detalhe-value">${sol.city || 'N√£o informado'}</div>
            </div>
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üìå Estado</div>
              <div class="solicitacao-detalhe-value">${sol.state || '--'}</div>
            </div>
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üìç Local</div>
              <div class="solicitacao-detalhe-value">${sol.venue || 'N√£o informado'}</div>
            </div>
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üë§ Contratante</div>
              <div class="solicitacao-detalhe-value">${sol.clientName || 'N√£o informado'}</div>
            </div>
            ${sol.clientPhone ? `
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üìû Telefone</div>
              <div class="solicitacao-detalhe-value">${sol.clientPhone}</div>
            </div>
            ` : ''}
            ${sol.clientEmail ? `
            <div class="solicitacao-detalhe">
              <div class="solicitacao-detalhe-label">üìß E-mail</div>
              <div class="solicitacao-detalhe-value">${sol.clientEmail}</div>
            </div>
            ` : ''}
          </div>

          ${sol.notes ? `
          <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.05); border-radius:12px">
            <div style="font-size:12px; color:var(--text-muted); font-weight:700; margin-bottom:8px">üìù OBSERVA√á√ïES</div>
            <div style="font-size:14px; color:var(--text-secondary); line-height:1.6">${sol.notes}</div>
          </div>
          ` : ''}

          ${sol.status === 'pendente' ? `
          <div class="solicitacao-actions">
            <button class="btn btnSave" onclick="aprovarSolicitacao('${sol.id}')">
              ‚úÖ Aprovar e Adicionar na Agenda
            </button>
            <button class="btn btnDanger" onclick="rejeitarSolicitacao('${sol.id}')">
              ‚ùå Rejeitar
            </button>
          </div>
          ` : ''}
        </div>
      `).join('')}
    `;
  }

  function updateSolicitacoesBadge(){
    const pendentes = solicitacoes.filter(s => s.status === 'pendente').length;
    const badge = document.getElementById('solicitacoesBadge');
    
    if(pendentes > 0){
      badge.textContent = pendentes;
      badge.style.display = 'block';
    } else {
      badge.style.display = 'none';
    }
  }

  function aprovarSolicitacao(id){
    const solicitacao = solicitacoes.find(s => s.id === id);
    if(!solicitacao) return;

    // Criar evento na agenda
    const newEvent = {
      id: generateId(),
      date: solicitacao.date,
      timeStart: solicitacao.timeStart || '20:00',
      timeEnd: solicitacao.timeEnd || '22:00',
      title: solicitacao.eventTitle || 'Show',
      city: solicitacao.city || '',
      state: solicitacao.state || '',
      venue: solicitacao.venue || '',
      client: solicitacao.clientName || '',
      phone: solicitacao.clientPhone || '',
      email: solicitacao.clientEmail || '',
      notes: (solicitacao.notes || '') + '\n\n[Solicitado via formul√°rio p√∫blico]',
      artist: solicitacao.artist || ARTISTS[0].id,
      status: 'RESERVADO',
      eventType: '',
      ticketType: '',
      duration: '',
      cache: '',
      company: '',
      contact: '',
      expenses: '',
      contractSent: false
    };

    events.push(newEvent);
    localStorage.setItem('agendaEvents', JSON.stringify(events));

    // Atualizar status da solicita√ß√£o
    solicitacao.status = 'aprovado';
    solicitacao.approvedAt = new Date().toISOString();
    localStorage.setItem('solicitacoes', JSON.stringify(solicitacoes));

    alert('‚úÖ Solicita√ß√£o aprovada! Evento adicionado na agenda.');
    renderSolicitacoes();
    render(); // Atualizar calend√°rio
  }

  function rejeitarSolicitacao(id){
    if(!confirm('‚ùå Tem certeza que deseja rejeitar esta solicita√ß√£o?')) return;

    const solicitacao = solicitacoes.find(s => s.id === id);
    if(!solicitacao) return;

    solicitacao.status = 'rejeitado';
    solicitacao.rejectedAt = new Date().toISOString();
    localStorage.setItem('solicitacoes', JSON.stringify(solicitacoes));

    renderSolicitacoes();
  }

  function gerarLinkSolicitacao(){
    // Gerar ID √∫nico para este link
    const linkId = 'link_' + Date.now().toString(36);
    
    // URL completa do formul√°rio p√∫blico
    const baseUrl = window.location.href.split('?')[0].replace('.html', '');
    const publicUrl = `${baseUrl}-formulario.html?id=${linkId}`;

    // Mostrar modal com o link
    const modal = document.getElementById('modalOverlay');
    const modalBody = modal.querySelector('.modal-body');
    
    document.getElementById('modalTitle').textContent = 'üîó Link Gerado!';
    document.getElementById('modalSubtitle').textContent = 'Compartilhe este link com o contratante';

    modalBody.innerHTML = `
      <div class="link-modal-content">
        <div style="text-align:center; margin-bottom:30px">
          <div style="font-size:64px; margin-bottom:20px">üîó</div>
          <h3 style="font-size:22px; font-weight:900; color:var(--text); margin-bottom:10px">
            Link para Formul√°rio de Solicita√ß√£o
          </h3>
          <p style="font-size:15px; color:var(--text-muted); font-weight:600">
            Envie este link para o contratante preencher os dados do evento
          </p>
        </div>

        <div class="link-box">
          <div class="link-url" id="generatedLink">${publicUrl}</div>
          <button class="btn-copy" onclick="copyLink()">
            üìã Copiar
          </button>
        </div>

        <div style="margin-top:25px; padding:20px; background:rgba(0,240,255,0.1); border-radius:12px; border:1px solid rgba(0,240,255,0.2)">
          <div style="font-size:14px; font-weight:700; color:var(--accent); margin-bottom:10px">‚ÑπÔ∏è Como funciona:</div>
          <ul style="font-size:13px; color:var(--text-secondary); line-height:1.8; padding-left:20px">
            <li>O contratante acessa o link e preenche data, hor√°rio, local, etc</li>
            <li>A solicita√ß√£o aparece aqui no painel "Solicita√ß√µes"</li>
            <li>Voc√™ analisa e pode <strong>Aprovar</strong> ou <strong>Rejeitar</strong></li>
            <li>Se aprovado, o evento √© automaticamente adicionado na agenda!</li>
          </ul>
        </div>

        <div style="margin-top:25px; display:flex; gap:12px">
          <button class="btn btnSecondary" onclick="closeModal()" style="flex:1">
            Fechar
          </button>
          <button class="btn btnPrimary" onclick="copyLinkAndClose()" style="flex:1">
            üìã Copiar e Fechar
          </button>
        </div>
      </div>
    `;

    modal.classList.add('show');
  }

  function copyLink(){
    const linkText = document.getElementById('generatedLink').textContent;
    navigator.clipboard.writeText(linkText).then(() => {
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚úÖ Copiado!';
      btn.style.background = 'linear-gradient(135deg, var(--success), #00D4FF)';
      setTimeout(() => {
        btn.innerHTML = originalText;
        btn.style.background = 'linear-gradient(135deg, var(--warning), #FF6B00)';
      }, 2000);
    }).catch(err => {
      alert('Erro ao copiar. Por favor, copie manualmente: ' + linkText);
    });
  }

  function copyLinkAndClose(){
    copyLink();
    setTimeout(() => {
      closeModal();
    }, 1000);
  }

  // Verificar badge ao carregar
  updateSolicitacoesBadge();

  // ==================== DASHBOARD ANALYTICS ====================

  function toggleDashboard(){
    const dashboard = document.getElementById('dashboardSection');
    const isVisible = dashboard.style.display !== 'none';
    
    if(isVisible){
      dashboard.style.display = 'none';
      document.getElementById('btnDashboard').textContent = 'üìä Dashboard';
    } else {
      dashboard.style.display = 'block';
      document.getElementById('btnDashboard').textContent = '‚úï Fechar Dashboard';
      loadDashboard();
      // Scroll to dashboard
      setTimeout(() => {
        dashboard.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }
  }

  function loadDashboard(){
    // Calcular estat√≠sticas gerais
    const stats = calculateGeneralStats();
    
    // Atualizar quick stats
    document.getElementById('totalEventsCount').textContent = stats.totalEvents;
    document.getElementById('totalCitiesCount').textContent = stats.totalCities;
    document.getElementById('totalStatesCount').textContent = stats.totalStates;
    document.getElementById('totalRevenueCount').textContent = 'R$ ' + formatMoney(stats.totalRevenue);

    // Carregar vis√£o nacional por padr√£o
    switchDashboardTab('nacional');
  }

  function calculateGeneralStats(){
    const totalEvents = events.length;
    
    // Cidades √∫nicas
    const cities = new Set();
    events.forEach(e => {
      if(e.city) cities.add(e.city.toUpperCase());
    });
    
    // Estados √∫nicos
    const states = new Set();
    events.forEach(e => {
      if(e.state) states.add(e.state.toUpperCase());
    });
    
    // Faturamento total
    let totalRevenue = 0;
    events.forEach(event => {
      if(event.cache){
        const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
        const numeric = parseFloat(value);
        if(!isNaN(numeric)){
          totalRevenue += event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
        }
      }
    });

    return {
      totalEvents,
      totalCities: cities.size,
      totalStates: states.size,
      totalRevenue,
      cities: Array.from(cities),
      states: Array.from(states)
    };
  }

  function switchDashboardTab(tab, element){
    // Atualizar tabs ativos
    document.querySelectorAll('.dashboard-tab').forEach(t => t.classList.remove('active'));
    if(element) element.classList.add('active');

    // Renderizar conte√∫do baseado na tab
    const content = document.getElementById('dashboardContent');
    
    if(tab === 'nacional'){
      renderNacionalView(content);
    } else if(tab === 'regional'){
      renderRegionalView(content);
    } else if(tab === 'cidades'){
      renderCidadesView(content);
    }
  }

  function renderNacionalView(container){
    // An√°lise por estados
    const stateStats = {};
    events.forEach(event => {
      if(event.state){
        const state = event.state.toUpperCase();
        if(!stateStats[state]){
          stateStats[state] = { count: 0, revenue: 0, cities: new Set() };
        }
        stateStats[state].count++;
        if(event.city) stateStats[state].cities.add(event.city);
        
        if(event.cache){
          const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
          const numeric = parseFloat(value);
          if(!isNaN(numeric)){
            stateStats[state].revenue += event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
          }
        }
      }
    });

    // Ordenar estados por n√∫mero de shows
    const sortedStates = Object.entries(stateStats).sort((a, b) => b[1].count - a[1].count);

    // Estados brasileiros
    const allStates = ['AC','AL','AP','AM','BA','CE','DF','ES','GO','MA','MT','MS','MG','PA','PB','PR','PE','PI','RJ','RN','RS','RO','RR','SC','SP','SE','TO'];
    const visitedStates = Object.keys(stateStats);
    const notVisitedStates = allStates.filter(s => !visitedStates.includes(s));

    container.innerHTML = `
      <div class="charts-grid">
        <!-- Ranking de Estados -->
        <div class="chart-box">
          <div class="chart-title">üèÜ Top 10 Estados - Mais Shows</div>
          <div class="ranking-list">
            ${sortedStates.slice(0, 10).map((state, index) => `
              <div class="ranking-item">
                <div class="ranking-position ${index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : ''}">
                  ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}
                </div>
                <div class="ranking-info">
                  <div class="ranking-name">${state[0]}</div>
                  <div class="ranking-detail">${state[1].cities.size} cidade${state[1].cities.size > 1 ? 's' : ''} ‚Ä¢ R$ ${formatMoney(state[1].revenue)}</div>
                </div>
                <div class="ranking-value">${state[1].count}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <!-- Mapa de Cobertura -->
        <div class="chart-box">
          <div class="chart-title">üó∫Ô∏è Cobertura Nacional</div>
          <div class="map-container">
            <div class="map-icon">üáßüá∑</div>
            <div class="map-title">${visitedStates.length} de ${allStates.length} Estados Visitados</div>
            <div style="margin-bottom:20px">
              <span style="font-size:48px; font-weight:900; background:linear-gradient(135deg, var(--success), var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent">
                ${((visitedStates.length / allStates.length) * 100).toFixed(0)}%
              </span>
              <div style="font-size:14px; color:var(--text-muted); font-weight:700; margin-top:10px">DE COBERTURA</div>
            </div>
            <div class="states-grid">
              ${allStates.map(state => `
                <div class="state-badge ${visitedStates.includes(state) ? 'visited' : 'not-visited'}">
                  ${state}
                  ${visitedStates.includes(state) ? ' ‚úì' : ''}
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      </div>

      <!-- Insights -->
      <div class="insights-panel">
        <h3>ü§ñ Insights Nacional</h3>
        ${sortedStates.length > 0 ? `
        <div class="insight-row">
          <p>üèÜ <strong>${sortedStates[0][0]}</strong> √© o estado com mais shows: <strong>${sortedStates[0][1].count} apresenta√ß√µes</strong> em ${sortedStates[0][1].cities.size} cidades diferentes.</p>
        </div>
        ` : ''}
        
        ${notVisitedStates.length > 0 ? `
        <div class="insight-row">
          <p>üó∫Ô∏è Ainda n√£o visitou <strong>${notVisitedStates.length} estados</strong>: ${notVisitedStates.slice(0, 5).join(', ')}${notVisitedStates.length > 5 ? ` e mais ${notVisitedStates.length - 5}` : ''}.</p>
        </div>
        ` : `
        <div class="insight-row">
          <p>üéâ <strong>Parab√©ns!</strong> Voc√™ j√° visitou todos os estados brasileiros!</p>
        </div>
        `}

        ${sortedStates.length >= 3 ? `
        <div class="insight-row">
          <p>üí° <strong>Recomenda√ß√£o:</strong> Focar em expandir para os estados com menor presen√ßa: ${sortedStates.slice(-3).map(s => s[0]).join(', ')}.</p>
        </div>
        ` : ''}

        <div class="insight-row">
          <p>üìä <strong>Distribui√ß√£o:</strong> ${((visitedStates.length / allStates.length) * 100).toFixed(0)}% de cobertura nacional. ${visitedStates.length < 15 ? 'H√° muito potencial de crescimento!' : visitedStates.length < 23 ? 'Boa cobertura!' : 'Excelente cobertura nacional!'}</p>
        </div>
      </div>
    `;
  }

  function renderRegionalView(container){
    // An√°lise por regi√£o
    const regions = {
      'Norte': { states: ['AC','AP','AM','PA','RO','RR','TO'], count: 0, revenue: 0, states_visited: [] },
      'Nordeste': { states: ['AL','BA','CE','MA','PB','PE','PI','RN','SE'], count: 0, revenue: 0, states_visited: [] },
      'Centro-Oeste': { states: ['DF','GO','MT','MS'], count: 0, revenue: 0, states_visited: [] },
      'Sudeste': { states: ['ES','MG','RJ','SP'], count: 0, revenue: 0, states_visited: [] },
      'Sul': { states: ['PR','RS','SC'], count: 0, revenue: 0, states_visited: [] }
    };

    events.forEach(event => {
      if(event.state){
        const state = event.state.toUpperCase();
        for(const [regionName, regionData] of Object.entries(regions)){
          if(regionData.states.includes(state)){
            regionData.count++;
            if(!regionData.states_visited.includes(state)){
              regionData.states_visited.push(state);
            }
            
            if(event.cache){
              const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
              const numeric = parseFloat(value);
              if(!isNaN(numeric)){
                regionData.revenue += event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
              }
            }
            break;
          }
        }
      }
    });

    const sortedRegions = Object.entries(regions).sort((a, b) => b[1].count - a[1].count);

    container.innerHTML = `
      <div class="charts-grid">
        <!-- Ranking Regional -->
        <div class="chart-box">
          <div class="chart-title">üó∫Ô∏è Ranking Regional - Shows</div>
          <div class="ranking-list">
            ${sortedRegions.map((region, index) => `
              <div class="ranking-item">
                <div class="ranking-position ${index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : ''}">
                  ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}
                </div>
                <div class="ranking-info">
                  <div class="ranking-name">${region[0]}</div>
                  <div class="ranking-detail">
                    ${region[1].states_visited.length}/${region[1].states.length} estados ‚Ä¢ 
                    ${((region[1].states_visited.length / region[1].states.length) * 100).toFixed(0)}% cobertura
                  </div>
                </div>
                <div class="ranking-value">${region[1].count}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <!-- Faturamento Regional -->
        <div class="chart-box">
          <div class="chart-title">üí∞ Faturamento por Regi√£o</div>
          <div class="ranking-list">
            ${sortedRegions.sort((a, b) => b[1].revenue - a[1].revenue).map((region, index) => `
              <div class="ranking-item">
                <div class="ranking-position ${index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : ''}">
                  ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}
                </div>
                <div class="ranking-info">
                  <div class="ranking-name">${region[0]}</div>
                  <div class="ranking-detail">M√©dia: R$ ${region[1].count > 0 ? formatMoney(region[1].revenue / region[1].count) : '0'} por show</div>
                </div>
                <div class="ranking-value">R$ ${formatMoney(region[1].revenue)}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>

      <!-- Detalhes por Regi√£o -->
      <div class="charts-grid">
        ${Object.entries(regions).map(([regionName, regionData]) => `
          <div class="chart-box">
            <div class="chart-title">${regionName}</div>
            <div style="padding:20px">
              <div style="margin-bottom:20px">
                <div style="font-size:42px; font-weight:900; background:linear-gradient(135deg, var(--accent), #0080FF); -webkit-background-clip:text; -webkit-text-fill-color:transparent">
                  ${regionData.states_visited.length}/${regionData.states.length}
                </div>
                <div style="font-size:14px; color:var(--text-muted); font-weight:700; margin-top:5px">ESTADOS VISITADOS</div>
              </div>
              <div class="states-grid">
                ${regionData.states.map(state => `
                  <div class="state-badge ${regionData.states_visited.includes(state) ? 'visited' : 'not-visited'}">
                    ${state}
                    ${regionData.states_visited.includes(state) ? ' ‚úì' : ''}
                  </div>
                `).join('')}
              </div>
              <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.03); border-radius:12px">
                <div style="font-size:13px; color:var(--text-muted); font-weight:700; margin-bottom:8px">ESTAT√çSTICAS</div>
                <div style="display:flex; justify-content:space-between; margin-bottom:8px">
                  <span style="font-size:14px; font-weight:600">Shows:</span>
                  <span style="font-size:16px; font-weight:900; color:var(--accent)">${regionData.count}</span>
                </div>
                <div style="display:flex; justify-content:space-between">
                  <span style="font-size:14px; font-weight:600">Faturamento:</span>
                  <span style="font-size:16px; font-weight:900; color:var(--success)">R$ ${formatMoney(regionData.revenue)}</span>
                </div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>

      <!-- Insights Regionais -->
      <div class="insights-panel">
        <h3>ü§ñ Insights Regionais</h3>
        ${sortedRegions[0][1].count > 0 ? `
        <div class="insight-row">
          <p>üèÜ A regi√£o <strong>${sortedRegions[0][0]}</strong> lidera com <strong>${sortedRegions[0][1].count} shows</strong>, cobrindo ${sortedRegions[0][1].states_visited.length} de ${sortedRegions[0][1].states.length} estados.</p>
        </div>
        ` : ''}

        ${sortedRegions.find(r => r[1].count === 0) ? `
        <div class="insight-row">
          <p>‚ö†Ô∏è Regi√£o <strong>${sortedRegions.find(r => r[1].count === 0)[0]}</strong> ainda n√£o foi explorada. Grande oportunidade de expans√£o!</p>
        </div>
        ` : ''}

        <div class="insight-row">
          <p>üí∞ O <strong>${sortedRegions.sort((a, b) => b[1].revenue - a[1].revenue)[0][0]}</strong> gera o maior faturamento: <strong>R$ ${formatMoney(sortedRegions[0][1].revenue)}</strong>.</p>
        </div>

        <div class="insight-row">
          <p>üìä <strong>Recomenda√ß√£o:</strong> ${sortedRegions[sortedRegions.length - 1][1].count === 0 ? `Planejar turn√™ pelo ${sortedRegions[sortedRegions.length - 1][0]} para expandir cobertura.` : `Intensificar agenda no ${sortedRegions[0][0]} que j√° demonstra forte performance.`}</p>
        </div>
      </div>
    `;
  }

  function renderCidadesView(container){
    // An√°lise por cidades
    const cityStats = {};
    events.forEach(event => {
      if(event.city){
        const city = event.city.toUpperCase();
        if(!cityStats[city]){
          cityStats[city] = { count: 0, revenue: 0, state: event.state };
        }
        cityStats[city].count++;
        
        if(event.cache){
          const value = event.cache.toString().toUpperCase().replace('K', '').replace('R$', '').replace('.', '').replace(',', '.').trim();
          const numeric = parseFloat(value);
          if(!isNaN(numeric)){
            cityStats[city].revenue += event.cache.toString().toUpperCase().includes('K') ? numeric * 1000 : numeric;
          }
        }
      }
    });

    const sortedCities = Object.entries(cityStats).sort((a, b) => b[1].count - a[1].count);
    const sortedByRevenue = Object.entries(cityStats).sort((a, b) => b[1].revenue - a[1].revenue);

    container.innerHTML = `
      <div class="charts-grid">
        <!-- Top Cidades - Shows -->
        <div class="chart-box">
          <div class="chart-title">üèôÔ∏è Top 15 Cidades - Mais Shows</div>
          <div class="ranking-list">
            ${sortedCities.slice(0, 15).map((city, index) => `
              <div class="ranking-item">
                <div class="ranking-position ${index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : ''}">
                  ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}
                </div>
                <div class="ranking-info">
                  <div class="ranking-name">${city[0]}</div>
                  <div class="ranking-detail">${city[1].state ? city[1].state.toUpperCase() : ''} ‚Ä¢ R$ ${formatMoney(city[1].revenue)}</div>
                </div>
                <div class="ranking-value">${city[1].count}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <!-- Top Cidades - Faturamento -->
        <div class="chart-box">
          <div class="chart-title">üí∞ Top 15 Cidades - Faturamento</div>
          <div class="ranking-list">
            ${sortedByRevenue.slice(0, 15).map((city, index) => `
              <div class="ranking-item">
                <div class="ranking-position ${index === 0 ? 'top1' : index === 1 ? 'top2' : index === 2 ? 'top3' : ''}">
                  ${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : index + 1}
                </div>
                <div class="ranking-info">
                  <div class="ranking-name">${city[0]}</div>
                  <div class="ranking-detail">${city[1].state ? city[1].state.toUpperCase() : ''} ‚Ä¢ ${city[1].count} show${city[1].count > 1 ? 's' : ''}</div>
                </div>
                <div class="ranking-value">R$ ${formatMoney(city[1].revenue)}</div>
              </div>
            `).join('')}
          </div>
        </div>
      </div>

      <!-- Estat√≠sticas Gerais -->
      <div class="charts-grid" style="grid-template-columns:repeat(auto-fit, minmax(300px, 1fr))">
        <div class="chart-box">
          <div class="chart-title">üìä Cidade Mais Visitada</div>
          <div style="text-align:center; padding:40px 20px">
            <div style="font-size:72px; margin-bottom:20px">üèÜ</div>
            <div style="font-size:32px; font-weight:900; color:var(--text); margin-bottom:10px">
              ${sortedCities[0] ? sortedCities[0][0] : 'N/A'}
            </div>
            <div style="font-size:18px; color:var(--text-muted); font-weight:700; margin-bottom:20px">
              ${sortedCities[0] ? sortedCities[0][1].state : ''}
            </div>
            <div style="font-size:48px; font-weight:900; background:linear-gradient(135deg, var(--accent), #0080FF); -webkit-background-clip:text; -webkit-text-fill-color:transparent">
              ${sortedCities[0] ? sortedCities[0][1].count : 0}
            </div>
            <div style="font-size:14px; color:var(--text-muted); font-weight:700; margin-top:5px">SHOWS REALIZADOS</div>
          </div>
        </div>

        <div class="chart-box">
          <div class="chart-title">üíé Cidade Mais Lucrativa</div>
          <div style="text-align:center; padding:40px 20px">
            <div style="font-size:72px; margin-bottom:20px">üí∞</div>
            <div style="font-size:32px; font-weight:900; color:var(--text); margin-bottom:10px">
              ${sortedByRevenue[0] ? sortedByRevenue[0][0] : 'N/A'}
            </div>
            <div style="font-size:18px; color:var(--text-muted); font-weight:700; margin-bottom:20px">
              ${sortedByRevenue[0] ? sortedByRevenue[0][1].state : ''}
            </div>
            <div style="font-size:48px; font-weight:900; background:linear-gradient(135deg, var(--success), #00D4FF); -webkit-background-clip:text; -webkit-text-fill-color:transparent">
              R$ ${sortedByRevenue[0] ? formatMoney(sortedByRevenue[0][1].revenue) : '0'}
            </div>
            <div style="font-size:14px; color:var(--text-muted); font-weight:700; margin-top:5px">FATURAMENTO TOTAL</div>
          </div>
        </div>

        <div class="chart-box">
          <div class="chart-title">üìç Total de Cidades</div>
          <div style="text-align:center; padding:40px 20px">
            <div style="font-size:72px; margin-bottom:20px">üó∫Ô∏è</div>
            <div style="font-size:64px; font-weight:900; background:linear-gradient(135deg, var(--primary), var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:10px">
              ${sortedCities.length}
            </div>
            <div style="font-size:14px; color:var(--text-muted); font-weight:700">CIDADES DIFERENTES</div>
            <div style="margin-top:25px; font-size:15px; font-weight:600; color:var(--text-secondary)">
              M√©dia de ${sortedCities.length > 0 ? (events.length / sortedCities.length).toFixed(1) : 0} shows por cidade
            </div>
          </div>
        </div>
      </div>

      <!-- Insights de Cidades -->
      <div class="insights-panel">
        <h3>ü§ñ Insights de Cidades</h3>
        ${sortedCities[0] ? `
        <div class="insight-row">
          <p>üèÜ <strong>${sortedCities[0][0]}</strong> √© a cidade campe√£ com <strong>${sortedCities[0][1].count} shows</strong> realizados!</p>
        </div>
        ` : ''}

        ${sortedByRevenue[0] && sortedByRevenue[0][0] !== sortedCities[0]?.[0] ? `
        <div class="insight-row">
          <p>üí∞ Apesar de n√£o ser a mais visitada, <strong>${sortedByRevenue[0][0]}</strong> √© a cidade que mais gera faturamento: <strong>R$ ${formatMoney(sortedByRevenue[0][1].revenue)}</strong>.</p>
        </div>
        ` : ''}

        <div class="insight-row">
          <p>üìä Voc√™ j√° se apresentou em <strong>${sortedCities.length} cidades diferentes</strong>, com uma m√©dia de <strong>${(events.length / sortedCities.length).toFixed(1)} shows por cidade</strong>.</p>
        </div>

        ${sortedCities.filter(c => c[1].count === 1).length > 0 ? `
        <div class="insight-row">
          <p>üéØ <strong>${sortedCities.filter(c => c[1].count === 1).length} cidades</strong> tiveram apenas 1 show. Considere retornar para fortalecer a presen√ßa nesses mercados!</p>
        </div>
        ` : ''}

        <div class="insight-row">
          <p>üí° <strong>Recomenda√ß√£o:</strong> ${sortedCities[0] && sortedCities[0][1].count > 5 ? `${sortedCities[0][0]} √© um mercado consolidado. Explore cidades vizinhas para expandir a regi√£o.` : `Focar em criar mercados fortes realizando shows peri√≥dicos nas mesmas cidades.`}</p>
        </div>
      </div>
    `;
  }
</script>
</body>
</html>
