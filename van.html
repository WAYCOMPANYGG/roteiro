<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Reserva da Van | WayCompanyGG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(135deg,#0f0f0f,#1b1b1b);
      font-family:Arial, sans-serif;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:16px;
    }

    .card{
      width:100%;
      max-width:760px;
      background:#121212;
      border-radius:18px;
      box-shadow:0 20px 50px rgba(0,0,0,.6);
      padding:18px;
    }

    h1{ margin:0 0 6px; text-align:center; font-size:22px; }
    p{ margin:0 0 14px; text-align:center; opacity:.8; font-size:14px; }

    .badge{
      text-align:center;
      font-size:12px;
      color:#ef4444;
      margin: 8px 0 10px;
      display:none;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      margin-bottom:14px;
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:800;
      font-size:14px;
      color:#fff;
      background:#374151;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-width: 160px;
    }
    .btn:hover{ opacity:.92; }
    .btn-admin{ background:#ef4444; }
    .btn-layout{ background:#2563eb; }
    .btn-save{ background:#16a34a; }
    .btn-back{ background:#374151; }

    .stage{
      position:relative;
      width:100%;
      max-width:720px;
      margin:0 auto;
      background:#0b0b0b;
      border-radius:16px;
      padding:12px;
      overflow:hidden;
    }

    .vanWrap{
      position:relative;
      width:100%;
      border-radius:14px;
      overflow:hidden;
      background:#0b0b0b;
    }

    .vanImg{
      width:100%;
      display:block;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    /* Etiqueta frente */
    .front-label{
      position:absolute;
      top:10px;
      left:50%;
      transform:translateX(-50%);
      font-size:11px;
      opacity:.75;
      background: rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.08);
      padding:6px 10px;
      border-radius:999px;
      pointer-events:none;
      z-index: 2;
    }

    /* Corredor */
    .corridor{
      position:absolute;
      left:50%;
      top:8%;
      width:18%;
      height:84%;
      transform:translateX(-50%);
      border-radius:14px;
      background: rgba(255,255,255,.035);
      outline: 1px dashed rgba(255,255,255,.10);
      pointer-events:none;
      z-index: 1;
    }

    /* Assentos (com cara de banco) */
    .seat{
      position:absolute;
      width:42px;
      height:36px;
      border-radius:10px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.15)), #2a2a2a;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 22px rgba(0,0,0,.45);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      cursor:pointer;
      user-select:none;
      transform: translate(-50%, -50%);
      z-index: 3;
      transition: .12s;
    }
    .seat:hover{ opacity:.92; }

    .seat .num{
      font-size:11px;
      opacity:.95;
      font-weight:900;
      line-height:1;
    }
    .seat .name{
      font-size:10px;
      opacity:.90;
      max-width:38px;
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
      line-height:1;
    }

    .seat.reserved{
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.10)), #7c3aed;
    }
    .seat.blocked{
      background: linear-gradient(180deg, rgba(255,255,255,.18), rgba(0,0,0,.10)), #ef4444;
      cursor:not-allowed;
    }
    .seat.layouting{
      outline: 2px dashed rgba(255,255,255,.45);
      cursor: grab;
    }
    .seat.layouting:active{ cursor: grabbing; }

    .legend{
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:center;
      font-size:12px;
      opacity:.9;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .legend .item{ display:flex; align-items:center; gap:6px; }
    .box{ width:14px; height:14px; border-radius:4px; }
    .bfree{ background:#2a2a2a; }
    .bres{ background:#7c3aed; }
    .bblk{ background:#ef4444; }

    .hint{
      margin-top:10px;
      text-align:center;
      font-size:12px;
      opacity:.65;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>üöê Reserva da Van</h1>
    <p>Clique em um lugar livre para reservar com seu nome</p>

    <div id="adminBadge" class="badge">üëÆ‚Äç‚ôÇÔ∏è MODO ADMIN ATIVO</div>

    <div class="row">
      <button id="adminBtn" class="btn btn-admin">üëÆ‚Äç‚ôÇÔ∏è Entrar Admin</button>
      <button id="exitAdminBtn" class="btn btn-back" style="display:none;">Sair Admin</button>

      <button id="layoutBtn" class="btn btn-layout" style="display:none;">üß© Editar posi√ß√µes</button>
      <button id="saveLayoutBtn" class="btn btn-save" style="display:none;">üíæ Salvar posi√ß√µes</button>

      <a href="index.html" class="btn btn-back">‚¨Ö Voltar</a>
    </div>

    <div class="stage">
      <div id="vanWrap" class="vanWrap">
        <img id="vanImg" class="vanImg" src="van.png?v=1" alt="Van" />
        <div class="front-label">FRENTE</div>
        <div class="corridor"></div>
        <!-- assentos inseridos via JS -->
      </div>

      <div class="legend">
        <div class="item"><span class="box bfree"></span> Livre</div>
        <div class="item"><span class="box bres"></span> Reservado</div>
        <div class="item"><span class="box bblk"></span> Bloqueado</div>
      </div>

      <div class="hint">
        Admin: clique em um lugar para <b>Bloquear/Desbloquear</b> ou <b>Liberar</b>.<br/>
        ‚ÄúEditar posi√ß√µes‚Äù: arraste os lugares em cima do PNG e clique ‚ÄúSalvar posi√ß√µes‚Äù.
      </div>
    </div>
  </div>

<script>
  // ===== CONFIG =====
  const TOTAL_SEATS = 12;
  const ADMIN_PASSWORD = "1234";
  const STORAGE_SEATS = "vanSeatsV3";
  const STORAGE_LAYOUT = "vanLayoutV1";
  // ==================

  const vanWrap = document.getElementById("vanWrap");
  const adminBtn = document.getElementById("adminBtn");
  const exitAdminBtn = document.getElementById("exitAdminBtn");
  const layoutBtn = document.getElementById("layoutBtn");
  const saveLayoutBtn = document.getElementById("saveLayoutBtn");
  const adminBadge = document.getElementById("adminBadge");
  const vanImg = document.getElementById("vanImg");

  let isAdmin = false;
  let isLayoutMode = false;

  // seat: { status: "free"|"reserved"|"blocked", name?: string }
  let seats = loadSeats();
  // layout: { x: 0..1, y: 0..1 } relativo ao container
  let layout = loadLayout();

  function loadSeats(){
    const raw = localStorage.getItem(STORAGE_SEATS);
    if(!raw) return Array.from({length: TOTAL_SEATS}, () => ({status:"free"}));
    try{
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed) || parsed.length !== TOTAL_SEATS){
        return Array.from({length: TOTAL_SEATS}, () => ({status:"free"}));
      }
      return parsed;
    }catch{
      return Array.from({length: TOTAL_SEATS}, () => ({status:"free"}));
    }
  }

  function saveSeats(){
    localStorage.setItem(STORAGE_SEATS, JSON.stringify(seats));
  }

  function defaultLayout(){
    // layout inicial em grid (depois voc√™ arrasta em cima do PNG)
    const positions = [];
    const cols = 4;
    const rows = Math.ceil(TOTAL_SEATS / cols);
    for(let i=0;i<TOTAL_SEATS;i++){
      const c = i % cols;
      const r = Math.floor(i / cols);
      const x = (c + 1) / (cols + 1);
      const y = (r + 1) / (rows + 1);
      positions.push({x,y});
    }
    return positions;
  }

  function loadLayout(){
    const raw = localStorage.getItem(STORAGE_LAYOUT);
    if(!raw) return defaultLayout();
    try{
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed) || parsed.length !== TOTAL_SEATS) return defaultLayout();
      return parsed;
    }catch{
      return defaultLayout();
    }
  }

  function saveLayout(){
    localStorage.setItem(STORAGE_LAYOUT, JSON.stringify(layout));
  }

  function render(){
    // remove assentos antigos
    vanWrap.querySelectorAll(".seat").forEach(el => el.remove());

    for(let i=0;i<TOTAL_SEATS;i++){
      const s = seats[i];
      const pos = layout[i];

      const seatEl = document.createElement("div");
      seatEl.className = "seat";
      seatEl.dataset.index = i;

      if(s.status === "reserved") seatEl.classList.add("reserved");
      if(s.status === "blocked") seatEl.classList.add("blocked");
      if(isLayoutMode) seatEl.classList.add("layouting");

      const safeName = (s.status === "reserved" && s.name) ? s.name : "";
      seatEl.innerHTML = `
        <div class="num">${i+1}</div>
        <div class="name">${safeName}</div>
      `;

      seatEl.style.left = (pos.x * 100) + "%";
      seatEl.style.top  = (pos.y * 100) + "%";

      seatEl.addEventListener("click", () => {
        if(isLayoutMode) return;
        handleSeatClick(i);
      });

      // drag no layout mode
      seatEl.addEventListener("pointerdown", (e) => {
        if(!isLayoutMode) return;
        seatEl.setPointerCapture(e.pointerId);

        const onMove = (ev) => {
          const wrapRect = vanWrap.getBoundingClientRect();
          const x = (ev.clientX - wrapRect.left) / wrapRect.width;
          const y = (ev.clientY - wrapRect.top) / wrapRect.height;

          layout[i] = {
            x: Math.min(0.98, Math.max(0.02, x)),
            y: Math.min(0.98, Math.max(0.02, y))
          };

          seatEl.style.left = (layout[i].x * 100) + "%";
          seatEl.style.top  = (layout[i].y * 100) + "%";
        };

        const onUp = () => {
          seatEl.removeEventListener("pointermove", onMove);
          seatEl.removeEventListener("pointerup", onUp);
          seatEl.removeEventListener("pointercancel", onUp);
        };

        seatEl.addEventListener("pointermove", onMove);
        seatEl.addEventListener("pointerup", onUp);
        seatEl.addEventListener("pointercancel", onUp);
      });

      vanWrap.appendChild(seatEl);
    }
  }

  function handleSeatClick(i){
    const s = seats[i];

    // usu√°rio normal
    if(!isAdmin){
      if(s.status !== "free") return;
      const name = prompt(`Digite seu nome para reservar o lugar ${i+1}:`);
      if(!name) return;
      seats[i] = { status: "reserved", name: name.trim() };
      saveSeats(); render();
      return;
    }

    // admin
    if(s.status === "free"){
      const action = prompt(
        `Admin - Lugar ${i+1}\n` +
        `1 = Reservar (com nome)\n` +
        `2 = Bloquear (vermelho)\n` +
        `3 = Cancelar`
      );

      if(action === "1"){
        const name = prompt("Nome para reservar:");
        if(!name) return;
        seats[i] = { status:"reserved", name: name.trim() };
        saveSeats(); render();
      } else if(action === "2"){
        seats[i] = { status:"blocked" };
        saveSeats(); render();
      }
      return;
    }

    if(s.status === "reserved"){
      const ok = confirm(`Liberar o lugar reservado por "${s.name || "algu√©m"}"?`);
      if(!ok) return;
      seats[i] = { status:"free" };
      saveSeats(); render();
      return;
    }

    if(s.status === "blocked"){
      const ok = confirm("Desbloquear este lugar?");
      if(!ok) return;
      seats[i] = { status:"free" };
      saveSeats(); render();
      return;
    }
  }

  adminBtn.onclick = () => {
    const pass = prompt("Senha do admin:");
    if(pass === ADMIN_PASSWORD){
      isAdmin = true;
      adminBadge.style.display = "block";
      adminBtn.style.display = "none";
      exitAdminBtn.style.display = "inline-flex";
      layoutBtn.style.display = "inline-flex";
      render();
    } else {
      alert("Senha incorreta");
    }
  };

  exitAdminBtn.onclick = () => {
    isAdmin = false;
    isLayoutMode = false;
    adminBadge.style.display = "none";
    adminBtn.style.display = "inline-flex";
    exitAdminBtn.style.display = "none";
    layoutBtn.style.display = "none";
    saveLayoutBtn.style.display = "none";
    layoutBtn.textContent = "üß© Editar posi√ß√µes";
    render();
  };

  layoutBtn.onclick = () => {
    isLayoutMode = !isLayoutMode;
    if(isLayoutMode){
      layoutBtn.textContent = "üß© Sair do editar";
      saveLayoutBtn.style.display = "inline-flex";
    } else {
      layoutBtn.textContent = "üß© Editar posi√ß√µes";
      saveLayoutBtn.style.display = "none";
    }
    render();
  };

  saveLayoutBtn.onclick = () => {
    saveLayout();
    alert("Posi√ß√µes salvas! ‚úÖ");
  };

  // render inicial e quando imagem carrega
  render();
  vanImg.addEventListener("load", () => render());
  vanImg.addEventListener("error", () => alert("N√£o achei o PNG van.png. Confere se est√° no repo e publicado."));
  window.addEventListener("resize", () => render());
</script>
</body>
</html>
